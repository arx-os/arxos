let assets=[];let currentPage=1;let pageSize=20;let sortField='id';let sortAsc=true;let charts={};function loadAssets(){const building=document.getElementById('filter-building').value;const system=document.getElementById('filter-system').value;const assetType=document.getElementById('filter-asset-type').value;const room=document.getElementById('filter-room').value;const status=document.getElementById('filter-status').value;let url=`/api/buildings/${building}/assets?`;if(system)url+=`system=${encodeURIComponent(system)}&`;if(assetType)url+=`assetType=${encodeURIComponent(assetType)}&`;if(room)url+=`roomId=${encodeURIComponent(room)}&`;if(status)url+=`status=${encodeURIComponent(status)}&`;const startTime=performance.now();if(window.arxLogger){window.arxLogger.info('Loading assets',{building_id:building,filters:{system,assetType,room,status},url:url});}
fetch(url,{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiRequest('GET',url,res.status,duration);}
return res.json();}).then(data=>{assets=data;currentPage=1;renderAssetTable();updateSummaryCards();renderCharts();if(window.arxLogger){window.arxLogger.businessEvent('asset_inventory','assets_loaded',{asset_count:data.length,building_id:building,filters:{system,assetType,room,status},page_size:pageSize});}}).catch(error=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiError('GET',url,error,0);window.arxLogger.error('Failed to load assets',{building_id:building,filters:{system,assetType,room,status},error:error.message});}});}
function renderAssetTable(){const startTime=performance.now();let sorted=[...assets];sorted.sort((a,b)=>{let v1=a[sortField],v2=b[sortField];if(typeof v1==='string')v1=v1.toLowerCase();if(typeof v2==='string')v2=v2.toLowerCase();if(v1<v2)return sortAsc?-1:1;if(v1>v2)return sortAsc?1:-1;return 0;});const start=(currentPage-1)*pageSize;const end=start+pageSize;const pageAssets=sorted.slice(start,end);const tbody=document.getElementById('asset-table-body');tbody.innerHTML='';for(const asset of pageAssets){const tr=document.createElement('tr');tr.innerHTML=`
      <td class="px-2 py-1"><input type="checkbox" class="asset-checkbox" value="${asset.id}"></td>
      <td class="px-2 py-1">${asset.id}</td>
      <td class="px-2 py-1">${asset.asset_type}</td>
      <td class="px-2 py-1">${asset.system}</td>
      <td class="px-2 py-1">${asset.location && asset.location.room ? asset.location.room : ''}</td>
      <td class="px-2 py-1">${asset.age ?? ''}</td>
      <td class="px-2 py-1">${asset.efficiency_rating ?? ''}</td>
      <td class="px-2 py-1">${asset.status ?? ''}</td>
      <td class="px-2 py-1">${asset.estimated_value ? '$' + asset.estimated_value.toLocaleString() : ''}</td>
      <td class="px-2 py-1">
        <button class="text-blue-600 hover:underline" onclick="openAssetModal('${asset.id}')">View</button>
      </td>
    `;tbody.appendChild(tr);}
document.getElementById('asset-count').textContent=`${assets.length} assets`;document.getElementById('page-info').textContent=`Page ${currentPage} of ${Math.ceil(assets.length / pageSize)}`;const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.performance('render_asset_table',duration,{total_assets:assets.length,page_assets:pageAssets.length,current_page:currentPage,sort_field:sortField,sort_ascending:sortAsc});}}
function sortAssets(field){if(window.arxLogger){window.arxLogger.info('Sorting assets',{field:field,previous_field:sortField,previous_ascending:sortAsc});}
if(sortField===field){sortAsc=!sortAsc;}else{sortField=field;sortAsc=true;}
renderAssetTable();}
function prevPage(){if(currentPage>1){if(window.arxLogger){window.arxLogger.info('Navigating to previous page',{from_page:currentPage,to_page:currentPage-1});}
currentPage--;renderAssetTable();}}
function nextPage(){if(currentPage<Math.ceil(assets.length/pageSize)){if(window.arxLogger){window.arxLogger.info('Navigating to next page',{from_page:currentPage,to_page:currentPage+1});}
currentPage++;renderAssetTable();}}
function toggleSelectAllAssets(){const checked=document.getElementById('select-all-assets').checked;const checkboxes=document.querySelectorAll('.asset-checkbox');const checkedCount=checked?checkboxes.length:0;checkboxes.forEach(cb=>cb.checked=checked);if(window.arxLogger){window.arxLogger.info('Toggled select all assets',{selected:checked,total_assets:checkboxes.length,selected_count:checkedCount});}}
function exportAssets(format){const building=document.getElementById('filter-building').value;let url=`/api/buildings/${building}/inventory/export?format=${format}`;if(window.arxLogger){window.arxLogger.info('Exporting assets',{format:format,building_id:building,url:url});}
window.open(url,'_blank');}
function exportAssetsAdvanced(){const building=document.getElementById('filter-building').value;const format=document.getElementById('export-format').value;const system=document.getElementById('export-system').value;const status=document.getElementById('export-status').value;const dateFrom=document.getElementById('export-date-from').value;const dateTo=document.getElementById('export-date-to').value;const includeHistory=document.getElementById('export-include-history').checked;const includeMaintenance=document.getElementById('export-include-maintenance').checked;const includeValuations=document.getElementById('export-include-valuations').checked;let url=`/api/buildings/${building}/inventory/export?format=${format}`;if(system)url+=`&system=${encodeURIComponent(system)}`;if(status)url+=`&status=${encodeURIComponent(status)}`;if(dateFrom)url+=`&dateFrom=${encodeURIComponent(dateFrom)}`;if(dateTo)url+=`&dateTo=${encodeURIComponent(dateTo)}`;if(includeHistory)url+=`&includeHistory=true`;if(includeMaintenance)url+=`&includeMaintenance=true`;if(includeValuations)url+=`&includeValuations=true`;const progress=document.getElementById('export-progress');progress.textContent='Preparing export...';const startTime=performance.now();if(window.arxLogger){window.arxLogger.info('Starting advanced asset export',{format:format,building_id:building,filters:{system,status,dateFrom,dateTo},options:{includeHistory,includeMaintenance,includeValuations},url:url});}
fetch(url,{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiRequest('GET',url,res.status,duration);}
if(!res.ok)throw new Error('Export failed');progress.textContent='Downloading...';return res.blob();}).then(blob=>{const a=document.createElement('a');a.href=window.URL.createObjectURL(blob);a.download=`asset_inventory_export.${format}`;document.body.appendChild(a);a.click();a.remove();progress.textContent='Download complete.';setTimeout(()=>{progress.textContent='';},2000);showToast('Export complete.','success');if(window.arxLogger){window.arxLogger.businessEvent('asset_inventory','export_completed',{format:format,building_id:building,file_size:blob.size});}}).catch((error)=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiError('GET',url,error,0);window.arxLogger.error('Asset export failed',{format:format,building_id:building,error:error.message});}
progress.textContent='Export failed.';setTimeout(()=>{progress.textContent='';},2000);showToast('Export failed.','error');});}
function deleteSelectedAssets(){const selected=Array.from(document.querySelectorAll('.asset-checkbox:checked')).map(cb=>cb.value);if(selected.length===0){if(window.arxLogger){window.arxLogger.warn('No assets selected for deletion');}
return alert('No assets selected.');}
if(!confirm(`Delete ${selected.length} assets?`)){if(window.arxLogger){window.arxLogger.info('Asset deletion cancelled by user',{selected_count:selected.length});}
return;}
if(window.arxLogger){window.arxLogger.info('Deleting selected assets',{selected_count:selected.length,asset_ids:selected});}
const startTime=performance.now();Promise.all(selected.map(id=>fetch(`/api/assets/${id}`,{method:'DELETE',headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}))).then((responses)=>{const duration=performance.now()-startTime;const successCount=responses.filter(r=>r.ok).length;const failureCount=responses.length-successCount;if(window.arxLogger){window.arxLogger.businessEvent('asset_inventory','assets_deleted',{total_requested:selected.length,success_count:successCount,failure_count:failureCount,duration_ms:duration});}
loadAssets();showToast('Assets deleted successfully.','success');}).catch((error)=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.error('Failed to delete assets',{selected_count:selected.length,error:error.message,duration_ms:duration});}
showToast('Failed to delete assets.','error');});}
function openAssetModal(assetId){const modal=document.getElementById('asset-modal');modal.classList.remove('hidden');if(window.arxLogger){window.arxLogger.info('Opening asset modal',{asset_id:assetId});}
if(assetId){const startTime=performance.now();fetch(`/api/assets/${assetId}`,{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiRequest('GET',`/api/assets/${assetId}`,res.status,duration);}
return res.json();}).then(asset=>{document.getElementById('asset-modal-title').textContent=`Edit Asset: ${asset.id}`;renderAssetForm(asset,true);loadAssetDetails(asset);if(window.arxLogger){window.arxLogger.info('Asset details loaded',{asset_id:asset.id,asset_type:asset.asset_type,system:asset.system});}
if(asset.symbol_id){addHighlightOnSVGButton(asset);}}).catch(error=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiError('GET',`/api/assets/${assetId}`,error,0);window.arxLogger.error('Failed to load asset details',{asset_id:assetId,error:error.message});}});}else{document.getElementById('asset-modal-title').textContent='Add New Asset';renderAssetForm({},false);clearAssetDetails();}}
function renderAssetForm(asset,isEdit){if(window.arxLogger){window.arxLogger.info('Rendering asset form',{is_edit:isEdit,asset_id:asset.id||null});}
const startTime=performance.now();fetch('/api/buildings',{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiRequest('GET','/api/buildings',res.status,duration);}
return res.json();}).then(buildings=>{let buildingOptions='<option value="">-- Select --</option>';for(const b of buildings){buildingOptions+=`<option value="${b.id}"${asset.building_id == b.id ? ' selected' : ''}>${b.name}</option>`;}
document.getElementById('asset-form').innerHTML=`
        <label class="block">Building:
          <select id="asset-building" class="border rounded p-2 w-full" onchange="loadFloorsForAsset()">${buildingOptions}</select>
        </label>
        <label class="block">Floor:
          <select id="asset-floor" class="border rounded p-2 w-full"></select>
        </label>
        <label class="block">Room:
          <input id="asset-room" class="border rounded p-2 w-full" value="${asset.room_id ?? ''}">
        </label>
        <label class="block">Asset Type:
          <input id="asset-type" class="border rounded p-2 w-full" value="${asset.asset_type ?? ''}" required>
        </label>
        <label class="block">System:
          <input id="asset-system" class="border rounded p-2 w-full" value="${asset.system ?? ''}" required>
        </label>
        <label class="block">Location X:
          <input id="asset-x" type="number" step="any" class="border rounded p-2 w-full" value="${asset.location?.x ?? ''}">
        </label>
        <label class="block">Location Y:
          <input id="asset-y" type="number" step="any" class="border rounded p-2 w-full" value="${asset.location?.y ?? ''}">
        </label>
        <label class="block">Specifications (JSON):
          <textarea id="asset-specs" class="border rounded p-2 w-full" rows="3">${asset.specifications ? JSON.stringify(asset.specifications, null, 2) : ''}</textarea>
          <span id="specs-error" class="text-red-600 text-xs"></span>
        </label>
        <label class="block">Estimated Value:
          <input id="asset-value" type="number" step="any" class="border rounded p-2 w-full" value="${asset.estimated_value ?? ''}">
        </label>
        <label class="block">Replacement Cost:
          <input id="asset-replacement" type="number" step="any" class="border rounded p-2 w-full" value="${asset.replacement_cost ?? ''}">
        </label>
        <label class="block">Funding Source:
          <input id="asset-funding-source" type="text" class="border rounded p-2 w-full" value="${asset.funding_source ?? ''}" placeholder="e.g., Capital Budget, Grant, Operating Budget">
        </label>
        <label class="block">Status:
          <select id="asset-status" class="border rounded p-2 w-full">
            <option value="active"${asset.status === 'active' ? ' selected' : ''}>Active</option>
            <option value="inactive"${asset.status === 'inactive' ? ' selected' : ''}>Inactive</option>
            <option value="retired"${asset.status === 'retired' ? ' selected' : ''}>Retired</option>
          </select>
        </label>
        <div class="flex gap-4 mt-4">
          <button type="button" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" onclick="submitAssetForm(${isEdit ? `'${asset.id}'` : ''})">${isEdit ? 'Save Changes' : 'Create Asset'}</button>
          <button type="button" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400" onclick="closeAssetModal()">Cancel</button>
        </div>
      `;if(asset.building_id){loadFloorsForAsset(asset.floor_id);}
if(window.arxLogger){window.arxLogger.info('Asset form rendered',{building_count:buildings.length,is_edit:isEdit,asset_id:asset.id||null});}});}
function loadFloorsForAsset(selectedFloorId){const buildingId=document.getElementById('asset-building').value;const floorSelect=document.getElementById('asset-floor');floorSelect.innerHTML='<option value="">-- Select --</option>';if(window.arxLogger){window.arxLogger.info('Loading floors for asset',{building_id:buildingId,selected_floor_id:selectedFloorId});}
if(buildingId){const startTime=performance.now();fetch(`/api/buildings/${buildingId}/floors`,{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiRequest('GET',`/api/buildings/${buildingId}/floors`,res.status,duration);}
return res.json();}).then(floors=>{for(const f of floors){floorSelect.innerHTML+=`<option value="${f.id}"${selectedFloorId == f.id ? ' selected' : ''}>${f.name}</option>`;}
if(window.arxLogger){window.arxLogger.info('Floors loaded for asset',{building_id:buildingId,floor_count:floors.length,selected_floor_id:selectedFloorId});}});}}
function submitAssetForm(assetId){if(window.arxLogger){window.arxLogger.info('Submitting asset form',{is_edit:!!assetId,asset_id:assetId||null});}
const buildingId=document.getElementById('asset-building').value;const floorId=document.getElementById('asset-floor').value;const roomId=document.getElementById('asset-room').value;const assetType=document.getElementById('asset-type').value;const system=document.getElementById('asset-system').value;const x=parseFloat(document.getElementById('asset-x').value);const y=parseFloat(document.getElementById('asset-y').value);const specsText=document.getElementById('asset-specs').value;const value=parseFloat(document.getElementById('asset-value').value);const replacement=parseFloat(document.getElementById('asset-replacement').value);const fundingSource=document.getElementById('asset-funding-source').value;const status=document.getElementById('asset-status').value;let specifications;try{specifications=specsText?JSON.parse(specsText):{};document.getElementById('specs-error').textContent='';}catch(e){if(window.arxLogger){window.arxLogger.error('Invalid JSON in asset specifications',{error:e.message,specs_text:specsText});}
document.getElementById('specs-error').textContent='Invalid JSON';showToast('Specifications must be valid JSON.','error');return;}
if(!buildingId||!assetType||!system){if(window.arxLogger){window.arxLogger.warn('Asset form validation failed',{building_id:buildingId,asset_type:assetType,system:system});}
alert('Building, Asset Type, and System are required.');return;}
const assetData={building_id:buildingId,floor_id:floorId,room_id:roomId,asset_type:assetType,system:system,location:{x,y},specifications,estimated_value:isNaN(value)?null:value,replacement_cost:isNaN(replacement)?null:replacement,funding_source:fundingSource,status:status};const method=assetId?'PUT':'POST';const url=assetId?`/api/assets/${assetId}`:`/api/buildings/${buildingId}/assets`;const startTime=performance.now();if(window.arxLogger){window.arxLogger.info('Submitting asset data',{method:method,url:url,asset_data:{building_id:buildingId,floor_id:floorId,asset_type:assetType,system:system,funding_source:fundingSource,status:status}});}
fetch(url,{method,headers:{'Content-Type':'application/json',...(localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{})},body:JSON.stringify(assetData)}).then(res=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiRequest(method,url,res.status,duration);}
if(res.ok){closeAssetModal();loadAssets();if(window.arxLogger){window.arxLogger.businessEvent('asset_inventory',assetId?'asset_updated':'asset_created',{asset_id:assetId||'new',building_id:buildingId,asset_type:assetType,system:system,funding_source:fundingSource});}
showToast(assetId?'Asset updated successfully.':'Asset created successfully.','success');}else{res.text().then(t=>{if(window.arxLogger){window.arxLogger.error('Asset submission failed',{method:method,url:url,status:res.status,error:t});}
alert('Error: '+t);});}}).catch(error=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiError(method,url,error,0);window.arxLogger.error('Asset submission failed',{method:method,url:url,error:error.message,duration_ms:duration});}});}
function loadAssetDetails(asset){if(window.arxLogger){window.arxLogger.info('Loading asset details',{asset_id:asset.id,asset_type:asset.asset_type});}
const startTime=performance.now();fetch(`/api/assets/${asset.id}/history`,{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>{const duration=performance.now()-startTime;if(window.arxLogger){window.arxLogger.apiRequest('GET',`/api/assets/${asset.id}/history`,res.status,duration);}
return res.json();}).then(history=>{document.getElementById('asset-history-timeline').innerHTML=history.map(h=>`<div>${h.event_type}: ${h.description} (${new Date(h.event_date).toLocaleDateString()})</div>`).join('')||'<div class="text-gray-400">No history records.</div>';}).catch(()=>{document.getElementById('asset-history-timeline').innerHTML='<div class="text-red-500">Failed to load history.</div>';});fetch(`/api/assets/${asset.id}/maintenance`,{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>res.json()).then(maint=>{document.getElementById('asset-maintenance-records').innerHTML=maint.map(m=>`<div>${m.maintenance_type}: ${m.description} (${new Date(m.scheduled_date).toLocaleDateString()})</div>`).join('')||'<div class="text-gray-400">No maintenance records.</div>';}).catch(()=>{document.getElementById('asset-maintenance-records').innerHTML='<div class="text-red-500">Failed to load maintenance.</div>';});fetch(`/api/assets/${asset.id}/valuations`,{headers:localStorage.getItem('arx_jwt')?{'Authorization':'Bearer '+localStorage.getItem('arx_jwt')}:{}}).then(res=>res.json()).then(vals=>{document.getElementById('asset-valuation-history').innerHTML=vals.map(v=>`<div>${v.valuation_type}: $${v.value} (${new Date(v.valuation_date).toLocaleDateString()})</div>`).join('')||'<div class="text-gray-400">No valuation records.</div>';}).catch(()=>{document.getElementById('asset-valuation-history').innerHTML='<div class="text-red-500">Failed to load valuations.</div>';});document.getElementById('asset-documents').innerHTML='<div class="text-gray-400">No documents linked.</div>';}
function clearAssetDetails(){document.getElementById('asset-history-timeline').textContent='';document.getElementById('asset-maintenance-records').textContent='';document.getElementById('asset-valuation-history').textContent='';document.getElementById('asset-documents').textContent='';}
function closeAssetModal(){document.getElementById('asset-modal').classList.add('hidden');}
function updateSummaryCards(){const totalAssets=assets.length;const totalValue=assets.reduce((sum,asset)=>sum+(asset.estimated_value||0),0);const avgAge=assets.length>0?assets.reduce((sum,asset)=>sum+(asset.age||0),0)/assets.length:0;const activeAssets=assets.filter(asset=>asset.status==='active').length;const activePercentage=totalAssets>0?Math.round((activeAssets/totalAssets)*100):0;const building=document.getElementById('filter-building');const buildingName=building.options[building.selectedIndex]?.text||'All Buildings';document.getElementById('total-assets').textContent=totalAssets;document.getElementById('total-assets-building').textContent=buildingName;document.getElementById('total-value').textContent='$'+totalValue.toLocaleString();document.getElementById('avg-age').textContent=Math.round(avgAge);document.getElementById('active-assets').textContent=activeAssets;document.getElementById('active-percentage').textContent=`${activePercentage}% of total`;}
function renderCharts(){Object.values(charts).forEach(chart=>{if(chart&&typeof chart.destroy==='function'){chart.destroy();}});charts={};renderSystemChart();renderAgeChart();renderEfficiencyChart();renderMaintenanceChart();}
function renderSystemChart(){const ctx=document.getElementById('system-chart').getContext('2d');const systemCounts={};assets.forEach(asset=>{systemCounts[asset.system]=(systemCounts[asset.system]||0)+1;});charts.systemChart=new Chart(ctx,{type:'doughnut',data:{labels:Object.keys(systemCounts),datasets:[{data:Object.values(systemCounts),backgroundColor:['#FF6384','#36A2EB','#FFCE56','#4BC0C0','#9966FF','#FF9F40']}]},options:{responsive:true,plugins:{legend:{position:'bottom'}}}});}
function renderAgeChart(){const ctx=document.getElementById('age-chart').getContext('2d');const ageRanges={'0-5':0,'6-10':0,'11-15':0,'16-20':0,'20+':0};assets.forEach(asset=>{const age=asset.age||0;if(age<=5)ageRanges['0-5']++;else if(age<=10)ageRanges['6-10']++;else if(age<=15)ageRanges['11-15']++;else if(age<=20)ageRanges['16-20']++;else ageRanges['20+']++;});charts.ageChart=new Chart(ctx,{type:'bar',data:{labels:Object.keys(ageRanges),datasets:[{label:'Number of Assets',data:Object.values(ageRanges),backgroundColor:'#36A2EB'}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});}
function renderEfficiencyChart(){const ctx=document.getElementById('efficiency-chart').getContext('2d');const efficiencyRanges={'0-50%':0,'51-75%':0,'76-90%':0,'91-100%':0};assets.forEach(asset=>{const efficiency=parseFloat(asset.efficiency_rating?.replace('%','')||'0');if(efficiency<=50)efficiencyRanges['0-50%']++;else if(efficiency<=75)efficiencyRanges['51-75%']++;else if(efficiency<=90)efficiencyRanges['76-90%']++;else efficiencyRanges['91-100%']++;});charts.efficiencyChart=new Chart(ctx,{type:'pie',data:{labels:Object.keys(efficiencyRanges),datasets:[{data:Object.values(efficiencyRanges),backgroundColor:['#FF6384','#FFCE56','#36A2EB','#4BC0C0']}]},options:{responsive:true,plugins:{legend:{position:'bottom'}}}});}
function renderMaintenanceChart(){const ctx=document.getElementById('maintenance-chart').getContext('2d');const months=['Jan','Feb','Mar','Apr','May','Jun'];const costs=[1200,1900,3000,5000,2000,3000];charts.maintenanceChart=new Chart(ctx,{type:'line',data:{labels:months,datasets:[{label:'Maintenance Costs ($)',data:costs,borderColor:'#FF6384',backgroundColor:'rgba(255, 99, 132, 0.1)',tension:0.1}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});}
function addHighlightOnSVGButton(asset){const modalTitle=document.getElementById('asset-modal-title');const existingButton=document.getElementById('highlight-svg-button');if(existingButton){existingButton.remove();}
const highlightButton=document.createElement('button');highlightButton.id='highlight-svg-button';highlightButton.className='ml-2 bg-blue-500 hover:bg-blue-700 text-white text-sm font-bold py-1 px-3 rounded';highlightButton.textContent='Show on SVG';highlightButton.onclick=()=>highlightAssetOnSVG(asset.id);modalTitle.appendChild(highlightButton);}
function highlightAssetOnSVG(assetId){window.open(`/svg_view.html?asset=${assetId}`,'_blank');}
function showAssetTab(tab){document.querySelectorAll('.asset-tab-content').forEach(el=>el.classList.add('hidden'));document.getElementById(`asset-tab-${tab}`).classList.remove('hidden');}
function showToast(message,type='info'){if(window.arxLogger){window.arxLogger.info('Showing toast message',{message:message,type:type});}
const toastArea=document.getElementById('toast-area');const toast=document.createElement('div');toast.className=`px-4 py-2 rounded shadow text-white mb-2 ${type === 'success' ? 'bg-green-600' : type === 'error' ? 'bg-red-600' : 'bg-blue-600'}`;toast.textContent=message;toastArea.appendChild(toast);setTimeout(()=>toast.remove(),4000);}
function addAssetFromSymbol(){if(window.arxLogger){window.arxLogger.info('Adding asset from symbol',{integration_point:'symbol_placement'});}
showToast('Symbol placement integration coming soon!','info');}
document.addEventListener('DOMContentLoaded',()=>{if(window.arxLogger){window.arxLogger.info('Asset inventory page loaded',{page:'asset_inventory',url:window.location.href});}
loadBuildings();loadAssets();updateSummaryCards();renderCharts();});