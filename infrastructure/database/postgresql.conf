# PostgreSQL Configuration for Arxos Platform
# Slow Query Logging Configuration

# =============================================================================
# SLOW QUERY LOGGING SETTINGS
# =============================================================================

# Enable slow query logging (queries taking longer than 500ms)
log_min_duration_statement = 500

# Log statement type (none, ddl, mod, all)
log_statement = 'none'

# Enable logging collector
logging_collector = on

# Log directory (relative to data directory)
log_directory = 'pg_log'

# Log filename pattern
log_filename = 'postgresql-slow-%Y-%m-%d_%H%M%S.log'

# Log line prefix with structured information
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Log destination (stderr, csvlog, syslog)
log_destination = 'stderr'

# Log rotation settings
log_rotation_age = 1d
log_rotation_size = 100MB

# =============================================================================
# PERFORMANCE MONITORING SETTINGS
# =============================================================================

# Enable query statistics
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all

# Enable detailed query planning
log_parser_stats = off
log_planner_stats = off
log_executor_stats = off

# =============================================================================
# CONNECTION AND SESSION SETTINGS
# =============================================================================

# Connection settings
max_connections = 100
shared_preload_libraries = 'pg_stat_statements'

# Session settings
log_temp_files = 0
log_checkpoints = on
log_connections = on
log_disconnections = on

# =============================================================================
# STATISTICS COLLECTION
# =============================================================================

# Enable statistics collection
track_activity_query_size = 1024
stats_temp_directory = 'pg_stat_tmp'

# =============================================================================
# SLOW QUERY ANALYSIS SETTINGS
# =============================================================================

# Log slow queries with execution plan
log_min_messages = warning

# Enable query plan logging for slow queries
log_statement_stats = off

# =============================================================================
# ARXOS-SPECIFIC SETTINGS
# =============================================================================

# Application name for identification
application_name = 'arxos_platform'

# Custom settings for Arxos monitoring
# These will be used by the slow query parser
arxos.slow_query_threshold = 500
arxos.enable_performance_logging = on
arxos.log_query_plans = on
arxos.track_user_sessions = on
