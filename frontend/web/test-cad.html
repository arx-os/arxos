<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arxos CAD Test</title>
    
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Custom CAD Styles -->
    <link rel="stylesheet" href="static/css/cad.css">
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Arxos CAD Test</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <!-- Test Results -->
            <div class="bg-gray-800 p-4 rounded">
                <h2 class="text-xl font-semibold mb-2">Test Results</h2>
                <div id="test-results" class="space-y-2 text-sm">
                    <div>Loading tests...</div>
                </div>
            </div>
            
            <!-- CAD Interface -->
            <div class="bg-gray-800 p-4 rounded">
                <h2 class="text-xl font-semibold mb-2">CAD Interface</h2>
                <div class="h-64 bg-white rounded border">
                    <canvas id="test-canvas" class="w-full h-full"></canvas>
                </div>
                <div class="mt-2 text-sm">
                    <div>Mouse: <span id="mouse-coords">X: 0, Y: 0</span></div>
                    <div>Objects: <span id="object-count">0</span></div>
                </div>
            </div>
        </div>
        
        <!-- Test Controls -->
        <div class="mt-4 bg-gray-800 p-4 rounded">
            <h2 class="text-xl font-semibold mb-2">Test Controls</h2>
            <div class="flex space-x-2">
                <button id="test-init" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Test Initialization</button>
                <button id="test-draw" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">Test Drawing</button>
                <button id="test-export" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">Test Export</button>
                <button id="test-ai" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded">Test AI</button>
            </div>
        </div>
    </div>

    <!-- CAD Engine Scripts -->
    <script src="static/js/cad-engine.js"></script>
    <script src="static/js/cad-workers.js"></script>
    <script src="static/js/arx-objects.js"></script>
    <script src="static/js/cad-ui.js"></script>
    <script src="static/js/ai-assistant.js"></script>
    <script src="static/js/cad-tests.js"></script>
    
    <!-- Test Script -->
    <script>
        class CadTest {
            constructor() {
                this.results = [];
                this.cadEngine = null;
                this.arxObjectSystem = null;
                this.aiAssistant = null;
            }
            
            async runTests() {
                this.log('Starting Arxos CAD Tests...');
                
                try {
                    // Test 1: Check if all classes are loaded
                    await this.testClassLoading();
                    
                    // Test 2: Test CAD Engine initialization
                    await this.testCadEngineInit();
                    
                    // Test 3: Test ArxObject System
                    await this.testArxObjectSystem();
                    
                    // Test 4: Test AI Assistant
                    await this.testAiAssistant();
                    
                    // Test 5: Test Drawing
                    await this.testDrawing();
                    
                    this.log('✅ All tests completed successfully!');
                    
                } catch (error) {
                    this.log('❌ Test failed: ' + error.message);
                    console.error('Test error:', error);
                }
            }
            
            async testClassLoading() {
                this.log('Testing class loading...');
                
                if (typeof CadEngine === 'undefined') {
                    throw new Error('CadEngine class not loaded');
                }
                
                if (typeof ArxObjectSystem === 'undefined') {
                    throw new Error('ArxObjectSystem class not loaded');
                }
                
                if (typeof AiAssistant === 'undefined') {
                    throw new Error('AiAssistant class not loaded');
                }
                
                this.log('✅ All classes loaded successfully');
            }
            
            async testCadEngineInit() {
                this.log('Testing CAD Engine initialization...');
                
                this.cadEngine = new CadEngine();
                await this.cadEngine.initialize('test-canvas');
                
                this.log('✅ CAD Engine initialized successfully');
            }
            
            async testArxObjectSystem() {
                this.log('Testing ArxObject System...');
                
                this.arxObjectSystem = new ArxObjectSystem();
                
                // Test creating an ArxObject
                const geometry = {
                    type: 'rectangle',
                    startPoint: { x: 0, y: 0 },
                    endPoint: { x: 100, y: 100 }
                };
                
                const arxObject = this.arxObjectSystem.createArxObject('room', geometry, {
                    name: 'Test Room',
                    type: 'bedroom'
                });
                
                if (!arxObject || !arxObject.id) {
                    throw new Error('Failed to create ArxObject');
                }
                
                this.log('✅ ArxObject System working correctly');
            }
            
            async testAiAssistant() {
                this.log('Testing AI Assistant...');
                
                this.aiAssistant = new AiAssistant();
                
                // Test AI message processing
                const response = await this.aiAssistant.processMessage('Hello', this.arxObjectSystem);
                
                if (!response || typeof response !== 'string') {
                    throw new Error('AI Assistant not responding correctly');
                }
                
                this.log('✅ AI Assistant working correctly');
            }
            
            async testDrawing() {
                this.log('Testing drawing functionality...');
                
                // Test creating a simple object
                const arxObject = this.cadEngine.createArxObject(
                    { x: 50, y: 50 },
                    { x: 150, y: 150 }
                );
                
                if (!arxObject) {
                    throw new Error('Failed to create drawing object');
                }
                
                this.cadEngine.addArxObject(arxObject);
                
                // Update object count
                document.getElementById('object-count').textContent = this.cadEngine.arxObjects.size;
                
                this.log('✅ Drawing functionality working correctly');
            }
            
            log(message) {
                const resultsDiv = document.getElementById('test-results');
                const div = document.createElement('div');
                div.textContent = message;
                resultsDiv.appendChild(div);
                console.log(message);
            }
        }
        
        // Initialize tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const test = new CadTest();
            
            // Test initialization button
            document.getElementById('test-init').addEventListener('click', () => {
                test.runTests();
            });
            
            // Test drawing button
            document.getElementById('test-draw').addEventListener('click', () => {
                test.testDrawing();
            });
            
            // Test export button
            document.getElementById('test-export').addEventListener('click', () => {
                if (test.cadEngine) {
                    const svg = test.cadEngine.exportToSVG();
                    console.log('SVG Export:', svg);
                    test.log('✅ SVG Export successful');
                } else {
                    test.log('❌ CAD Engine not initialized');
                }
            });
            
            // Test AI button
            document.getElementById('test-ai').addEventListener('click', () => {
                test.testAiAssistant();
            });
            
            // Mouse coordinate tracking
            const canvas = document.getElementById('test-canvas');
            if (canvas) {
                canvas.addEventListener('mousemove', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    document.getElementById('mouse-coords').textContent = `X: ${x.toFixed(1)}, Y: ${y.toFixed(1)}`;
                });
            }
            
                    // Auto-run tests
        setTimeout(() => {
            test.runTests();
        }, 1000);
        
        // Add comprehensive test suite
        const testSuite = new CadTestSuite();
        testSuite.initialize().then(() => {
            console.log('Comprehensive test suite ready');
        });
        
        // Add test suite button
        const testSuiteButton = document.createElement('button');
        testSuiteButton.className = 'bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded text-sm font-medium';
        testSuiteButton.textContent = 'Run Comprehensive Tests';
        testSuiteButton.addEventListener('click', async () => {
            const results = await testSuite.runAllTests();
            console.log('Comprehensive test results:', results);
        });
        
        document.querySelector('.flex.space-x-2').appendChild(testSuiteButton);
        });
    </script>
</body>
</html> 