version: '3.8'

# Production overrides and additions
services:
  # Nginx Reverse Proxy
  nginx:
    image: nginx:alpine
    container_name: arxos-nginx
    depends_on:
      - arxos
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ../../web:/usr/share/nginx/html:ro
    ports:
      - "80:80"
      - "443:443"
    networks:
      - arxos-network
    restart: unless-stopped

  # Production overrides for arxos service
  arxos:
    environment:
      # Production settings
      ARXOS_LOG_LEVEL: warn
      ARXOS_TELEMETRY: "true"
      ARXOS_ENABLE_TLS: "true"
      
      # Security hardening
      ARXOS_BCRYPT_COST: 14
      ARXOS_SESSION_TIMEOUT: 8h
      ARXOS_API_RATE_LIMIT: 1000
    
    # Remove debug port exposure
    ports:
      - "8080:8080"  # Only API port in production
    
    # Add health monitoring
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
