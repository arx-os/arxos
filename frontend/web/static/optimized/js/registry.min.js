let objectTypesRegistry=null;let behaviorProfilesRegistry=null;async function fetchRegistries(){const[objTypesRes,behaviorRes]=await Promise.all([fetch('/api/object-types'),fetch('/api/behavior-profiles')]);objectTypesRegistry=await objTypesRes.json();behaviorProfilesRegistry=await behaviorRes.json();}
function getObjectTypesRegistry(){return objectTypesRegistry;}
function getBehaviorProfilesRegistry(){return behaviorProfilesRegistry;}
function generateObjectId(building,floor,system,type,instance){const instanceStr=String(instance).padStart(3,'0');return`${building}_${floor}_${system}_${type}_${instanceStr}`;}
function isValidObjectId(id){const pattern=/^[A-Z0-9]{3,10}_L[0-9]{1,2}_(E|LV|FA|N|M|P)_[A-Z][a-zA-Z]+_[0-9]{3}$/;return pattern.test(id);}
function getNextInstanceNumber(objects,{building,floor,system,type}){const regex=new RegExp(`^${building}_${floor}_${system}_${type}_(\\d{3})$`);let maxInstance=0;for(const obj of objects){const match=obj.id&&obj.id.match(regex);if(match){const instanceNum=parseInt(match[1],10);if(instanceNum>maxInstance)maxInstance=instanceNum;}}
return maxInstance+1;}
export{fetchRegistries,getObjectTypesRegistry,getBehaviorProfilesRegistry,generateObjectId,isValidObjectId,getNextInstanceNumber};