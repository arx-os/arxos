# Arxos Deployment Configuration
# Comprehensive configuration for automated deployment pipeline

# Environment Configuration
environment: production
region: us-east-1
cluster_name: arxos-production-cluster
namespace: arxos-production

# Deployment Strategy
deployment_strategy:
  type: blue_green  # blue_green, rolling, canary
  blue_green:
    enabled: true
    traffic_switch_delay: 30  # seconds
    cleanup_old_deployments: true
  rolling:
    max_surge: 1
    max_unavailable: 0
  canary:
    enabled: false
    traffic_percentage: 10
    duration: 300  # seconds

# Approval Gates
approval_gates:
  enabled: true
  required_for:
    - production
    - critical_updates
  approvers:
    - admin@arxos.com
    - devops@arxos.com
  timeout_minutes: 60
  auto_approve_staging: true

# Rollback Configuration
rollback:
  enabled: true
  auto_rollback:
    enabled: true
    health_check_failures: 3
    performance_threshold: 0.95  # 95% of baseline
    timeout_minutes: 10
  manual_rollback:
    enabled: true
    max_versions: 5
  backup_retention:
    days: 30
    max_backups: 10

# Health Checks
health_checks:
  enabled: true
  timeout_seconds: 300
  interval_seconds: 10
  max_attempts: 30
  endpoints:
    - /health
    - /api/health
    - /api/version
    - /api/metrics
  custom_checks:
    - name: database_connectivity
      script: scripts/check_db.sh
    - name: external_services
      script: scripts/check_external.sh

# Monitoring Configuration
monitoring:
  enabled: true
  duration_minutes: 10
  check_interval_seconds: 30
  metrics:
    - cpu_usage
    - memory_usage
    - response_time
    - error_rate
    - throughput
  alerts:
    cpu_threshold: 80
    memory_threshold: 85
    response_time_threshold: 2000  # ms
    error_rate_threshold: 5  # percentage

# Security Configuration
security:
  image_scanning:
    enabled: true
    tools:
      - trivy
      - clair
    fail_on_critical: true
    fail_on_high: false
  secrets_management:
    enabled: true
    vault_integration: true
    rotation_enabled: true
  network_policies:
    enabled: true
    default_deny: true

# Performance Configuration
performance:
  load_testing:
    enabled: true
    duration_seconds: 300
    concurrent_users: 100
    ramp_up_seconds: 60
  resource_limits:
    cpu_request: 100m
    cpu_limit: 500m
    memory_request: 128Mi
    memory_limit: 512Mi
  scaling:
    min_replicas: 2
    max_replicas: 10
    target_cpu_utilization: 70

# Database Configuration
database:
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM
    retention_days: 30
    compression: true
  migration:
    enabled: true
    auto_migrate: false
    rollback_enabled: true
    timeout_minutes: 30

# Notification Configuration
notifications:
  slack:
    enabled: true
    webhook_url: ${SLACK_WEBHOOK_URL}
    channels:
      - deployments
      - alerts
  email:
    enabled: true
    recipients:
      - admin@arxos.com
      - devops@arxos.com
    smtp_server: smtp.arxos.com
  webhook:
    enabled: true
    endpoints:
      - https://api.arxos.com/webhooks/deployment

# Environment-Specific Configurations
environments:
  staging:
    domain: staging.arxos.com
    replicas: 2
    resources:
      cpu_request: 50m
      cpu_limit: 200m
      memory_request: 64Mi
      memory_limit: 256Mi
    monitoring:
      duration_minutes: 5
    approval:
      required: false
    rollback:
      auto_enabled: true
      timeout_minutes: 5

  production:
    domain: app.arxos.com
    replicas: 3
    resources:
      cpu_request: 100m
      cpu_limit: 500m
      memory_request: 128Mi
      memory_limit: 512Mi
    monitoring:
      duration_minutes: 10
    approval:
      required: true
      timeout_minutes: 60
    rollback:
      auto_enabled: true
      timeout_minutes: 10

# Service Configuration
services:
  backend:
    name: arxos-backend
    port: 8080
    health_path: /health
    readiness_path: /ready
    liveness_path: /live
    environment_variables:
      - ARX_ENV
      - DATABASE_URL
      - REDIS_URL
    secrets:
      - database_password
      - api_keys

  frontend:
    name: arxos-frontend
    port: 3000
    health_path: /health
    environment_variables:
      - REACT_APP_API_URL
      - REACT_APP_ENVIRONMENT
    build_args:
      - NODE_ENV=production

  svg_parser:
    name: arxos-svg-parser
    port: 8000
    health_path: /health
    environment_variables:
      - ARX_ENV
      - SYMBOL_LIBRARY_PATH
    volumes:
      - name: symbol-data
        mount_path: /app/symbols

# Infrastructure Configuration
infrastructure:
  cloud_provider: aws
  region: us-east-1
  vpc:
    cidr: 10.0.0.0/16
    subnets:
      - cidr: 10.0.1.0/24
        availability_zone: us-east-1a
      - cidr: 10.0.2.0/24
        availability_zone: us-east-1b
  load_balancer:
    type: application
    ssl_certificate: arn:aws:acm:us-east-1:123456789012:certificate/example
    health_check_path: /health
  database:
    engine: postgresql
    version: 13.7
    instance_class: db.t3.micro
    storage_gb: 20
    backup_retention_days: 7
  cache:
    engine: redis
    node_type: cache.t3.micro
    num_cache_nodes: 1

# CI/CD Integration
cicd:
  github_actions:
    enabled: true
    workflow_file: .github/workflows/deploy_pipeline.yml
    secrets:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - SLACK_WEBHOOK_URL
  jenkins:
    enabled: false
    pipeline_name: arxos-deployment
  gitlab_ci:
    enabled: false
    pipeline_file: .gitlab-ci.yml

# Testing Configuration
testing:
  unit_tests:
    enabled: true
    coverage_threshold: 90
    timeout_minutes: 10
  integration_tests:
    enabled: true
    timeout_minutes: 30
    parallel_execution: true
  performance_tests:
    enabled: true
    baseline_response_time: 200  # ms
    acceptable_degradation: 20  # percentage
  security_tests:
    enabled: true
    tools:
      - bandit
      - safety
      - trivy
    fail_on_critical: true

# Logging Configuration
logging:
  level: info
  format: json
  output:
    - stdout
    - file
  retention:
    days: 30
    max_size_mb: 100
  aggregation:
    enabled: true
    service: cloudwatch

# Metrics Configuration
metrics:
  collection:
    enabled: true
    interval_seconds: 15
  export:
    prometheus:
      enabled: true
      port: 9090
    cloudwatch:
      enabled: true
      namespace: Arxos/Deployment
  dashboards:
    grafana:
      enabled: true
      url: https://grafana.arxos.com
    cloudwatch:
      enabled: true

# Backup Configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2 AM
  retention:
    days: 30
    max_backups: 10
  storage:
    type: s3
    bucket: arxos-backups
    encryption: true
  components:
    - kubernetes_resources
    - database
    - configuration
    - persistent_volumes

# Disaster Recovery
disaster_recovery:
  enabled: true
  rto_minutes: 60  # Recovery Time Objective
  rpo_minutes: 15  # Recovery Point Objective
  backup_strategy:
    full_backup: daily
    incremental_backup: hourly
  recovery_procedures:
    - name: database_restore
      script: scripts/recover_database.sh
      timeout_minutes: 30
    - name: application_restore
      script: scripts/recover_application.sh
      timeout_minutes: 15

# Compliance Configuration
compliance:
  enabled: true
  standards:
    - SOC2
    - GDPR
    - HIPAA
  audit_logging:
    enabled: true
    retention_days: 365
  data_encryption:
    at_rest: true
    in_transit: true
    key_rotation: true 