const token=localStorage.getItem('arx_jwt');function isAuthenticated(){return!!localStorage.getItem('arx_jwt');}
function logout(){localStorage.removeItem('arx_jwt');window.location.href='login.html';}
function getAuthHeaders(){const token=localStorage.getItem('arx_jwt');return token?{'Authorization':'Bearer '+token}:{};}
function handleAuthError(){localStorage.removeItem('arx_jwt');window.location.href='login.html';}
if(!isAuthenticated()){window.location.href='login.html';}
if(window.htmx){document.body.addEventListener('htmx:configRequest',function(evt){const token=localStorage.getItem('arx_jwt');if(token){evt.detail.headers['Authorization']='Bearer '+token;}});}
function parseJwt(token){try{const base64Url=token.split('.')[1];const base64=base64Url.replace(/-/g,'+').replace(/_/g,'/');const jsonPayload=decodeURIComponent(atob(base64).split('').map(function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2);}).join(''));return JSON.parse(jsonPayload);}catch(e){return{};}}
(function(){const token=localStorage.getItem('arx_jwt');if(token&&document.getElementById('user-info')){const payload=parseJwt(token);if(payload.username){document.getElementById('user-info').textContent=payload.username;}else if(payload.email){document.getElementById('user-info').textContent=payload.email;}}})();
