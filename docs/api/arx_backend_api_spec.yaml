openapi: 3.0.3
info:
  title: Arx Backend API
  description: |
    Comprehensive API for the Arx Backend service providing BIM object management,
    asset inventory, CMMS integration, maintenance workflows, and compliance reporting.

    ## Authentication
    The API uses JWT Bearer token authentication. Include the token in the Authorization header:
    ```
    Authorization: Bearer <your-jwt-token>
    ```

    ## Rate Limiting
    - Public endpoints: 100 requests/second, burst of 200
    - Authenticated endpoints: 50 requests/second, burst of 100

    ## Error Handling
    All endpoints return standard HTTP status codes with detailed error messages in JSON format.
  version: 1.0.0
  contact:
    name: Arx Development Team
    email: dev@arxos.com
  license:
    name: Proprietary
    url: https://arxos.com/license

servers:
  - url: http://localhost:8080/api
    description: Development server
  - url: https://api.arxos.com/api
    description: Production server

tags:
  - name: Authentication
    description: User registration, login, and authentication
  - name: Health
    description: Health check and monitoring endpoints
  - name: Projects
    description: Project management operations
  - name: Buildings
    description: Building and floor management
  - name: BIM Objects
    description: BIM object CRUD operations (walls, rooms, devices, etc.)
  - name: Assets
    description: Asset inventory and lifecycle management
  - name: CMMS
    description: CMMS integration and synchronization
  - name: Maintenance
    description: Maintenance tasks and workflows
  - name: Export
    description: Export activities and analytics
  - name: Compliance
    description: Audit logs and compliance reporting
  - name: Security
    description: Security management and monitoring
  - name: Admin
    description: Administrative operations
  - name: Symbols
    description: Symbol management and search
  - name: Chat
    description: Chat and comment operations
  - name: Comments
    description: Comment operations
  - name: Drawings
    description: Drawing operations
  - name: Markup
    description: Markup operations
  - name: Routes
    description: Route operations
  - name: Objects
    description: Object information and SVG generation
  - name: Logs
    description: Building logs and system logs
  - name: Version Control
    description: Version control and history management

paths:
  /register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account with the provided credentials
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  minLength: 3
                  maxLength: 50
                  description: Unique username for the account
                email:
                  type: string
                  format: email
                  description: Valid email address
                password:
                  type: string
                  minLength: 8
                  description: Secure password
                role:
                  type: string
                  enum: [viewer, editor, admin]
                  default: viewer
                  description: User role for access control
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    description: User ID
                  username:
                    type: string
                  email:
                    type: string
                  role:
                    type: string
                  token:
                    type: string
                    description: JWT authentication token
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: Username or email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /login:
    post:
      tags:
        - Authentication
      summary: Authenticate user
      description: Login with username/email and password to receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: Username or email address
                password:
                  type: string
                  description: User password
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT authentication token
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /me:
    get:
      tags:
        - Authentication
      summary: Get current user information
      description: Retrieve information about the currently authenticated user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Current user information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Check the health status of the API and its dependencies
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy, degraded, unhealthy]
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                  database:
                    type: object
                    properties:
                      status:
                        type: string
                      response_time:
                        type: number
                  redis:
                    type: object
                    properties:
                      status:
                        type: string
                      response_time:
                        type: number

  /db/health:
    get:
      tags:
        - Health
      summary: Database health check
      description: Check the health status of the database connection
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Database is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  connection_pool:
                    type: object
                    properties:
                      open_connections:
                        type: integer
                      in_use:
                        type: integer
                      idle:
                        type: integer
                      max_open:
                        type: integer
        '503':
          description: Database is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /db/pool-stats:
    get:
      tags:
        - Health
      summary: Database connection pool statistics
      description: Get detailed statistics about the database connection pool
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Connection pool statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  max_open_connections:
                    type: integer
                  open_connections:
                    type: integer
                  in_use:
                    type: integer
                  idle:
                    type: integer
                  wait_count:
                    type: integer
                  wait_duration:
                    type: integer
                  max_idle_closed:
                    type: integer
                  max_lifetime_closed:
                    type: integer

  /projects:
    get:
      tags:
        - Projects
      summary: List projects
      description: Retrieve a list of all projects accessible to the current user
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of projects
          content:
            application/json:
              schema:
                type: object
                properties:
                  projects:
                    type: array
                    items:
                      $ref: '#/components/schemas/Project'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - Projects
      summary: Create project
      description: Create a new project
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
      responses:
        '201':
          description: Project created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'

  /projects/{id}:
    get:
      tags:
        - Projects
      summary: Get project
      description: Retrieve a specific project by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Project details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'

  /buildings:
    get:
      tags:
        - Buildings
      summary: List buildings
      description: Retrieve a list of all buildings
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive, maintenance]
      responses:
        '200':
          description: List of buildings
          content:
            application/json:
              schema:
                type: object
                properties:
                  buildings:
                    type: array
                    items:
                      $ref: '#/components/schemas/Building'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - Buildings
      summary: Create building
      description: Create a new building
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                address:
                  type: string
                city:
                  type: string
                state:
                  type: string
                zip_code:
                  type: string
                country:
                  type: string
                  default: "USA"
                building_type:
                  type: string
                total_floors:
                  type: integer
                  minimum: 1
                total_area:
                  type: number
                  minimum: 0
                year_built:
                  type: integer
      responses:
        '201':
          description: Building created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Building'

  /buildings/{id}:
    get:
      tags:
        - Buildings
      summary: Get building
      description: Retrieve a specific building by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Building details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Building'

    put:
      tags:
        - Buildings
      summary: Update building
      description: Update an existing building
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Building'
      responses:
        '200':
          description: Building updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Building'

  /buildings/{id}/floors:
    get:
      tags:
        - Buildings
      summary: List building floors
      description: Retrieve all floors for a specific building
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of floors
          content:
            application/json:
              schema:
                type: object
                properties:
                  floors:
                    type: array
                    items:
                      $ref: '#/components/schemas/Floor'

  # BIM Objects - Walls
  /walls:
    get:
      tags:
        - BIM Objects
      summary: List walls
      description: Retrieve a paginated list of walls with optional filtering
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: building_id
          in: query
          schema:
            type: integer
        - name: floor_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive, maintenance]
      responses:
        '200':
          description: List of walls
          content:
            application/json:
              schema:
                type: object
                properties:
                  walls:
                    type: array
                    items:
                      $ref: '#/components/schemas/Wall'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - BIM Objects
      summary: Create wall
      description: Create a new wall (admin/editor only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - building_id
                - floor_id
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                building_id:
                  type: integer
                floor_id:
                  type: integer
                coordinates:
                  type: object
                  properties:
                    x1:
                      type: number
                    y1:
                      type: number
                    x2:
                      type: number
                    y2:
                      type: number
                properties:
                  type: object
                  additionalProperties: true
      responses:
        '201':
          description: Wall created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Wall'

  /walls/{id}:
    get:
      tags:
        - BIM Objects
      summary: Get wall
      description: Retrieve a specific wall by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Wall details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Wall'

    patch:
      tags:
        - BIM Objects
      summary: Update wall
      description: Update an existing wall (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                coordinates:
                  type: object
                properties:
                  type: object
      responses:
        '200':
          description: Wall updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Wall'

    delete:
      tags:
        - BIM Objects
      summary: Delete wall
      description: Delete a wall (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Wall deleted successfully

  /wall/{id}/lock:
    post:
      tags:
        - BIM Objects
      summary: Lock wall
      description: Lock a wall for editing (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Wall locked successfully

  /wall/{id}/unlock:
    post:
      tags:
        - BIM Objects
      summary: Unlock wall
      description: Unlock a wall for editing (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Wall unlocked successfully

  /wall/{id}/assign:
    post:
      tags:
        - BIM Objects
      summary: Assign wall
      description: Assign a wall to a user or team (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - assigned_to
              properties:
                assigned_to:
                  type: string
                  description: User ID or team name
                notes:
                  type: string
      responses:
        '200':
          description: Wall assigned successfully

  /wall/{id}/status:
    post:
      tags:
        - BIM Objects
      summary: Update wall status
      description: Update the status of a wall (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [active, inactive, maintenance, archived]
                notes:
                  type: string
      responses:
        '200':
          description: Wall status updated successfully

  # BIM Objects - Rooms
  /rooms:
    get:
      tags:
        - BIM Objects
      summary: List rooms
      description: Retrieve a paginated list of rooms
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: building_id
          in: query
          schema:
            type: integer
        - name: floor_id
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of rooms
          content:
            application/json:
              schema:
                type: object
                properties:
                  rooms:
                    type: array
                    items:
                      $ref: '#/components/schemas/Room'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - BIM Objects
      summary: Create room
      description: Create a new room (admin/editor only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - building_id
                - floor_id
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                building_id:
                  type: integer
                floor_id:
                  type: integer
                room_number:
                  type: string
                room_type:
                  type: string
                area:
                  type: number
                  minimum: 0
                coordinates:
                  type: object
                  properties:
                    x:
                      type: number
                    y:
                      type: number
                    width:
                      type: number
                    height:
                      type: number
      responses:
        '201':
          description: Room created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'

  /rooms/{id}:
    get:
      tags:
        - BIM Objects
      summary: Get room
      description: Retrieve a specific room by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Room details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'

    patch:
      tags:
        - BIM Objects
      summary: Update room
      description: Update an existing room (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                room_number:
                  type: string
                room_type:
                  type: string
                area:
                  type: number
                coordinates:
                  type: object
      responses:
        '200':
          description: Room updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Room'

    delete:
      tags:
        - BIM Objects
      summary: Delete room
      description: Delete a room (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Room deleted successfully

  # BIM Objects - Devices
  /devices:
    get:
      tags:
        - BIM Objects
      summary: List devices
      description: Retrieve a paginated list of devices
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: building_id
          in: query
          schema:
            type: integer
        - name: device_type
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of devices
          content:
            application/json:
              schema:
                type: object
                properties:
                  devices:
                    type: array
                    items:
                      $ref: '#/components/schemas/Device'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - BIM Objects
      summary: Create device
      description: Create a new device (admin/editor only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - device_type
                - building_id
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                device_type:
                  type: string
                building_id:
                  type: integer
                floor_id:
                  type: integer
                room_id:
                  type: integer
                manufacturer:
                  type: string
                model:
                  type: string
                serial_number:
                  type: string
                coordinates:
                  type: object
                  properties:
                    x:
                      type: number
                    y:
                      type: number
      responses:
        '201':
          description: Device created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'

  /devices/{id}:
    get:
      tags:
        - BIM Objects
      summary: Get device
      description: Retrieve a specific device by ID
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Device details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'

    patch:
      tags:
        - BIM Objects
      summary: Update device
      description: Update an existing device (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                device_type:
                  type: string
                manufacturer:
                  type: string
                model:
                  type: string
                serial_number:
                  type: string
                coordinates:
                  type: object
      responses:
        '200':
          description: Device updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'

    delete:
      tags:
        - BIM Objects
      summary: Delete device
      description: Delete a device (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Device deleted successfully

  # Asset Management
  /buildings/{buildingId}/assets:
    get:
      tags:
        - Assets
      summary: Get building assets
      description: Retrieve all assets for a specific building with audit logging
      security:
        - BearerAuth: []
      parameters:
        - name: buildingId
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: asset_type
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive, maintenance, retired]
      responses:
        '200':
          description: List of building assets
          content:
            application/json:
              schema:
                type: object
                properties:
                  assets:
                    type: array
                    items:
                      $ref: '#/components/schemas/Asset'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - Assets
      summary: Create building asset
      description: Create a new asset for a building with audit logging
      security:
        - BearerAuth: []
      parameters:
        - name: buildingId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - asset_type
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                asset_type:
                  type: string
                manufacturer:
                  type: string
                model:
                  type: string
                serial_number:
                  type: string
                location:
                  type: string
                purchase_date:
                  type: string
                  format: date
                purchase_cost:
                  type: number
                  minimum: 0
                warranty_expiry:
                  type: string
                  format: date
                status:
                  type: string
                  enum: [active, inactive, maintenance, retired]
                  default: active
      responses:
        '201':
          description: Asset created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Asset'

  /assets/{assetId}:
    get:
      tags:
        - Assets
      summary: Get building asset
      description: Retrieve a specific asset by ID
      security:
        - BearerAuth: []
      parameters:
        - name: assetId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Asset details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Asset'

    put:
      tags:
        - Assets
      summary: Update building asset
      description: Update an existing asset with audit logging
      security:
        - BearerAuth: []
      parameters:
        - name: assetId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Asset'
      responses:
        '200':
          description: Asset updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Asset'

    delete:
      tags:
        - Assets
      summary: Delete building asset
      description: Delete an asset with audit logging
      security:
        - BearerAuth: []
      parameters:
        - name: assetId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Asset deleted successfully

  /assets/{assetId}/history:
    post:
      tags:
        - Assets
      summary: Add asset history
      description: Add a history entry for an asset
      security:
        - BearerAuth: []
      parameters:
        - name: assetId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - event_type
                - description
              properties:
                event_type:
                  type: string
                  enum: [maintenance, repair, inspection, replacement, upgrade]
                description:
                  type: string
                cost:
                  type: number
                  minimum: 0
                performed_by:
                  type: string
                performed_date:
                  type: string
                  format: date
      responses:
        '201':
          description: Asset history added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetHistory'

  /assets/{assetId}/maintenance:
    post:
      tags:
        - Assets
      summary: Add asset maintenance
      description: Add a maintenance record for an asset
      security:
        - BearerAuth: []
      parameters:
        - name: assetId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - maintenance_type
                - description
              properties:
                maintenance_type:
                  type: string
                  enum: [preventive, corrective, emergency]
                description:
                  type: string
                scheduled_date:
                  type: string
                  format: date
                completed_date:
                  type: string
                  format: date
                cost:
                  type: number
                  minimum: 0
                technician:
                  type: string
                status:
                  type: string
                  enum: [scheduled, in_progress, completed, cancelled]
      responses:
        '201':
          description: Asset maintenance added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetMaintenance'

  /assets/{assetId}/valuations:
    post:
      tags:
        - Assets
      summary: Add asset valuation
      description: Add a valuation record for an asset
      security:
        - BearerAuth: []
      parameters:
        - name: assetId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - valuation_type
                - value
              properties:
                valuation_type:
                  type: string
                  enum: [market, replacement, book, insurance]
                value:
                  type: number
                  minimum: 0
                valuation_date:
                  type: string
                  format: date
                appraiser:
                  type: string
                notes:
                  type: string
      responses:
        '201':
          description: Asset valuation added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AssetValuation'

  /buildings/{buildingId}/inventory/export:
    get:
      tags:
        - Assets
      summary: Export building inventory
      description: Export building inventory with audit logging
      security:
        - BearerAuth: []
      parameters:
        - name: buildingId
          in: path
          required: true
          schema:
            type: integer
        - name: format
          in: query
          schema:
            type: string
            enum: [csv, excel, pdf]
            default: csv
      responses:
        '200':
          description: Inventory export file
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /buildings/{buildingId}/inventory/summary:
    get:
      tags:
        - Assets
      summary: Get building inventory summary
      description: Get a summary of building inventory with audit logging
      security:
        - BearerAuth: []
      parameters:
        - name: buildingId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Building inventory summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InventorySummary'

  # CMMS Integration
  /cmms/connections:
    get:
      tags:
        - CMMS
      summary: Get CMMS connections
      description: Retrieve all CMMS connections
      security:
        - BearerAuth: []
      responses:
        '200':
          description: List of CMMS connections
          content:
            application/json:
              schema:
                type: object
                properties:
                  connections:
                    type: array
                    items:
                      $ref: '#/components/schemas/CMMSConnection'

    post:
      tags:
        - CMMS
      summary: Create CMMS connection
      description: Create a new CMMS connection
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
                - base_url
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                type:
                  type: string
                  enum: [upkeep, fiix, custom]
                base_url:
                  type: string
                  format: uri
                api_key:
                  type: string
                username:
                  type: string
                password:
                  type: string
                oauth2_client_id:
                  type: string
                oauth2_secret:
                  type: string
                oauth2_token_url:
                  type: string
                  format: uri
                oauth2_scope:
                  type: string
                sync_interval_min:
                  type: integer
                  minimum: 1
                  default: 60
                is_active:
                  type: boolean
                  default: true
      responses:
        '201':
          description: CMMS connection created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CMMSConnection'

  /cmms/connections/{id}:
    get:
      tags:
        - CMMS
      summary: Get CMMS connection
      description: Retrieve a specific CMMS connection
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: CMMS connection details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CMMSConnection'

    put:
      tags:
        - CMMS
      summary: Update CMMS connection
      description: Update an existing CMMS connection
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CMMSConnection'
      responses:
        '200':
          description: CMMS connection updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CMMSConnection'

    delete:
      tags:
        - CMMS
      summary: Delete CMMS connection
      description: Delete a CMMS connection
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: CMMS connection deleted successfully

  /cmms/connections/{id}/test:
    post:
      tags:
        - CMMS
      summary: Test CMMS connection
      description: Test the connectivity and authentication for a CMMS connection
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Connection test results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  response_time:
                    type: number
                  capabilities:
                    type: array
                    items:
                      type: string

  /cmms/connections/{connectionId}/sync:
    post:
      tags:
        - CMMS
      summary: Sync CMMS data
      description: Trigger a manual sync for a CMMS connection
      security:
        - BearerAuth: []
      parameters:
        - name: connectionId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sync_type:
                  type: string
                  enum: [schedules, work_orders, specs, all]
                  default: all
      responses:
        '200':
          description: Sync operation started
          content:
            application/json:
              schema:
                type: object
                properties:
                  sync_id:
                    type: string
                  status:
                    type: string
                    enum: [started, in_progress, completed, failed]
                  message:
                    type: string

  /cmms/connections/{connectionId}/sync-logs:
    get:
      tags:
        - CMMS
      summary: Get CMMS sync logs
      description: Retrieve sync logs for a CMMS connection
      security:
        - BearerAuth: []
      parameters:
        - name: connectionId
          in: path
          required: true
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: CMMS sync logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      $ref: '#/components/schemas/CMMSSyncLog'

  /cmms/maintenance-schedules:
    get:
      tags:
        - CMMS
      summary: Get maintenance schedules
      description: Retrieve maintenance schedules from CMMS systems
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: asset_id
          in: query
          schema:
            type: integer
        - name: schedule_type
          in: query
          schema:
            type: string
            enum: [preventive, predictive, corrective]
      responses:
        '200':
          description: List of maintenance schedules
          content:
            application/json:
              schema:
                type: object
                properties:
                  schedules:
                    type: array
                    items:
                      $ref: '#/components/schemas/MaintenanceSchedule'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /cmms/work-orders:
    get:
      tags:
        - CMMS
      summary: Get work orders
      description: Retrieve work orders from CMMS systems
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: asset_id
          in: query
          schema:
            type: integer
        - name: status
          in: query
          schema:
            type: string
            enum: [open, in_progress, completed, cancelled]
        - name: priority
          in: query
          schema:
            type: string
            enum: [low, medium, high, critical]
      responses:
        '200':
          description: List of work orders
          content:
            application/json:
              schema:
                type: object
                properties:
                  work_orders:
                    type: array
                    items:
                      $ref: '#/components/schemas/WorkOrder'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  # Export Activities
  /export-activities:
    get:
      tags:
        - Export
      summary: Get export activities
      description: Retrieve export activity records
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: user_id
          in: query
          schema:
            type: integer
        - name: export_type
          in: query
          schema:
            type: string
            enum: [bim, asset, cmms, compliance]
      responses:
        '200':
          description: List of export activities
          content:
            application/json:
              schema:
                type: object
                properties:
                  activities:
                    type: array
                    items:
                      $ref: '#/components/schemas/ExportActivity'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - Export
      summary: Create export activity
      description: Create a new export activity record
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - export_type
                - file_name
              properties:
                export_type:
                  type: string
                  enum: [bim, asset, cmms, compliance]
                file_name:
                  type: string
                file_size:
                  type: integer
                  minimum: 0
                export_format:
                  type: string
                  enum: [json, csv, excel, pdf, svg, ifc, dxf]
                filters:
                  type: object
                  additionalProperties: true
                notes:
                  type: string
      responses:
        '201':
          description: Export activity created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportActivity'

  /export-activities/{id}:
    put:
      tags:
        - Export
      summary: Update export activity
      description: Update an existing export activity
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExportActivity'
      responses:
        '200':
          description: Export activity updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportActivity'

  /export-activities/{id}/download:
    post:
      tags:
        - Export
      summary: Increment download count
      description: Increment the download count for an export activity
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Download count incremented successfully

  /export-analytics/dashboard:
    get:
      tags:
        - Export
      summary: Get export analytics dashboard
      description: Get analytics dashboard data for export activities
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Export analytics dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportDashboard'

  /export-analytics:
    get:
      tags:
        - Export
      summary: Get export analytics
      description: Get detailed analytics for export activities
      security:
        - BearerAuth: []
      parameters:
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
        - name: export_type
          in: query
          schema:
            type: string
            enum: [bim, asset, cmms, compliance]
      responses:
        '200':
          description: Export analytics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportAnalytics'

  # BIM Export endpoints
  /bim/export/json:
    get:
      tags:
        - Export
      summary: Export BIM as JSON
      description: Export BIM data in JSON format
      security:
        - BearerAuth: []
      parameters:
        - name: building_id
          in: query
          required: true
          schema:
            type: integer
        - name: floor_id
          in: query
          schema:
            type: integer
        - name: include_properties
          in: query
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: BIM data in JSON format
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true

  /bim/export/ifc:
    get:
      tags:
        - Export
      summary: Export BIM as IFC
      description: Export BIM data in IFC format
      security:
        - BearerAuth: []
      parameters:
        - name: building_id
          in: query
          required: true
          schema:
            type: integer
        - name: floor_id
          in: query
          schema:
            type: integer
        - name: version
          in: query
          schema:
            type: string
            enum: [2x3, 4]
            default: 4
      responses:
        '200':
          description: BIM data in IFC format
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /bim/export/dxf:
    get:
      tags:
        - Export
      summary: Export BIM as DXF
      description: Export BIM data in DXF format
      security:
        - BearerAuth: []
      parameters:
        - name: building_id
          in: query
          required: true
          schema:
            type: integer
        - name: floor_id
          in: query
          schema:
            type: integer
        - name: layer_format
          in: query
          schema:
            type: string
            enum: [autocad, standard]
            default: standard
      responses:
        '200':
          description: BIM data in DXF format
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /bim/export/svg:
    get:
      tags:
        - Export
      summary: Export BIM as SVG
      description: Export BIM data in SVG format
      security:
        - BearerAuth: []
      parameters:
        - name: building_id
          in: query
          required: true
          schema:
            type: integer
        - name: floor_id
          in: query
          schema:
            type: integer
        - name: include_labels
          in: query
          schema:
            type: boolean
            default: true
        - name: scale
          in: query
          schema:
            type: number
            minimum: 0.1
            maximum: 10.0
            default: 1.0
      responses:
        '200':
          description: BIM data in SVG format
          content:
            image/svg+xml:
              schema:
                type: string

  # Symbol Library
  /symbols:
    get:
      tags:
        - Symbols
      summary: List symbols
      description: Retrieve a list of all symbols with optional search/filter
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: category
          in: query
          schema:
            type: string
        - name: search
          in: query
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [equipment, furniture, fixture, annotation]
      responses:
        '200':
          description: List of symbols
          content:
            application/json:
              schema:
                type: object
                properties:
                  symbols:
                    type: array
                    items:
                      $ref: '#/components/schemas/Symbol'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /symbols/{symbol_id}:
    get:
      tags:
        - Symbols
      summary: Get symbol
      description: Retrieve a specific symbol by ID
      security:
        - BearerAuth: []
      parameters:
        - name: symbol_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Symbol details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Symbol'

  /symbols/search:
    post:
      tags:
        - Symbols
      summary: Search symbols
      description: Advanced search for symbols with complex criteria
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                categories:
                  type: array
                  items:
                    type: string
                types:
                  type: array
                  items:
                    type: string
                tags:
                  type: array
                  items:
                    type: string
                page:
                  type: integer
                  minimum: 1
                  default: 1
                limit:
                  type: integer
                  minimum: 1
                  maximum: 100
                  default: 20
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  symbols:
                    type: array
                    items:
                      $ref: '#/components/schemas/Symbol'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                  total_results:
                    type: integer

  /symbols/categories:
    get:
      tags:
        - Symbols
      summary: Get symbol categories
      description: Retrieve available symbol categories
      security:
        - BearerAuth: []
      responses:
        '200':
          description: List of symbol categories
          content:
            application/json:
              schema:
                type: object
                properties:
                  categories:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                        count:
                          type: integer

  /symbols/cache:
    delete:
      tags:
        - Symbols
      summary: Clear symbol cache
      description: Clear the symbol library cache (admin only)
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Symbol cache cleared successfully

  # Chat and Comments
  /buildings/{id}/chat:
    get:
      tags:
        - Chat
      summary: List chat messages
      description: Retrieve chat messages for a building
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of chat messages
          content:
            application/json:
              schema:
                type: object
                properties:
                  messages:
                    type: array
                    items:
                      $ref: '#/components/schemas/ChatMessage'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

    post:
      tags:
        - Chat
      summary: Post chat message
      description: Post a new chat message for a building
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  minLength: 1
                  maxLength: 1000
                message_type:
                  type: string
                  enum: [text, image, file, system]
                  default: text
                attachments:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: Chat message posted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatMessage'

  /object/{objectId}/comment:
    post:
      tags:
        - Comments
      summary: Post object comment
      description: Post a comment on a specific object
      security:
        - BearerAuth: []
      parameters:
        - name: objectId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - comment
              properties:
                comment:
                  type: string
                  minLength: 1
                  maxLength: 500
                comment_type:
                  type: string
                  enum: [general, issue, suggestion, question]
                  default: general
      responses:
        '201':
          description: Comment posted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'

  /comment/{id}:
    put:
      tags:
        - Comments
      summary: Edit comment
      description: Edit an existing comment
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - comment
              properties:
                comment:
                  type: string
                  minLength: 1
                  maxLength: 500
      responses:
        '200':
          description: Comment updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'

    delete:
      tags:
        - Comments
      summary: Delete comment
      description: Delete a comment
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Comment deleted successfully

  # Drawings
  /drawings:
    post:
      tags:
        - Drawings
      summary: Create drawing
      description: Create a new drawing
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - building_id
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                building_id:
                  type: integer
                floor_id:
                  type: integer
                drawing_type:
                  type: string
                  enum: [floor_plan, elevation, section, detail, as_built]
                scale:
                  type: number
                  minimum: 0.1
                  maximum: 100.0
                units:
                  type: string
                  enum: [mm, cm, m, inch, ft]
      responses:
        '201':
          description: Drawing created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Drawing'

  /drawings/{drawingID}/last_modified:
    get:
      tags:
        - Drawings
      summary: Get drawing last modified
      description: Get the last modified timestamp for a drawing
      security:
        - BearerAuth: []
      parameters:
        - name: drawingID
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Drawing last modified timestamp
          content:
            application/json:
              schema:
                type: object
                properties:
                  drawing_id:
                    type: integer
                  last_modified:
                    type: string
                    format: date-time
                  modified_by:
                    type: string

  # Markup
  /markup:
    post:
      tags:
        - Markup
      summary: Submit markup
      description: Submit markup for review
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - markup_data
                - object_id
              properties:
                markup_data:
                  type: object
                  additionalProperties: true
                object_id:
                  type: integer
                markup_type:
                  type: string
                  enum: [annotation, correction, addition, deletion]
                notes:
                  type: string
      responses:
        '201':
          description: Markup submitted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Markup'

  /markups:
    get:
      tags:
        - Markup
      summary: List markups
      description: Retrieve markups with filtering options
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: object_id
          in: query
          schema:
            type: integer
        - name: markup_type
          in: query
          schema:
            type: string
            enum: [annotation, correction, addition, deletion]
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, approved, rejected]
      responses:
        '200':
          description: List of markups
          content:
            application/json:
              schema:
                type: object
                properties:
                  markups:
                    type: array
                    items:
                      $ref: '#/components/schemas/Markup'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /markup/{id}:
    delete:
      tags:
        - Markup
      summary: Delete markup
      description: Delete a markup
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Markup deleted successfully

  # Routes
  /routes:
    post:
      tags:
        - Routes
      summary: Create route
      description: Create a new route
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - start_point
                - end_point
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                start_point:
                  type: object
                  properties:
                    x:
                      type: number
                    y:
                      type: number
                    floor_id:
                      type: integer
                end_point:
                  type: object
                  properties:
                    x:
                      type: number
                    y:
                      type: number
                    floor_id:
                      type: integer
                route_type:
                  type: string
                  enum: [evacuation, maintenance, visitor, emergency]
                waypoints:
                  type: array
                  items:
                    type: object
                    properties:
                      x:
                        type: number
                      y:
                        type: number
      responses:
        '201':
          description: Route created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Route'

  # Object Info and SVG
  /object/{objectId}/info:
    get:
      tags:
        - Objects
      summary: Get object info
      description: Get detailed information about a specific object
      security:
        - BearerAuth: []
      parameters:
        - name: objectId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Object information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ObjectInfo'

  /floor/svg:
    get:
      tags:
        - Objects
      summary: Serve floor SVG
      description: Get SVG representation of a floor
      security:
        - BearerAuth: []
      parameters:
        - name: floor_id
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: SVG content
          content:
            image/svg+xml:
              schema:
                type: string
        '404':
          description: Floor not found

  /svg-objects:
    get:
      tags:
        - Objects
      summary: List SVG objects
      description: Retrieve SVG objects
      security:
        - BearerAuth: []
      responses:
        '200':
          description: List of SVG objects
          content:
            application/json:
              schema:
                type: object
                properties:
                  objects:
                    type: array
                    items:
                      $ref: '#/components/schemas/SVGObject'

  # Logs
  /logs/{building_id}:
    get:
      tags:
        - Logs
      summary: Get building logs
      description: Retrieve logs for a specific building
      security:
        - BearerAuth: []
      parameters:
        - name: building_id
          in: path
          required: true
          schema:
            type: integer
        - name: log_type
          in: query
          schema:
            type: string
            enum: [access, change, error, system]
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Building logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      $ref: '#/components/schemas/LogEntry'

  # Version Control endpoints
  /versions/{floorId}:
    get:
      tags:
        - Version Control
      summary: Get version history
      description: Retrieve version history for a floor (admin/editor/viewer only)
      security:
        - BearerAuth: []
      parameters:
        - name: floorId
          in: path
          required: true
          schema:
            type: integer
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: Version history
          content:
            application/json:
              schema:
                type: object
                properties:
                  versions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Version'
                  total:
                    type: integer

  /versions/diff/{versionId1}/{versionId2}:
    get:
      tags:
        - Version Control
      summary: Get version diff
      description: Get differences between two versions (admin/editor/viewer only)
      security:
        - BearerAuth: []
      parameters:
        - name: versionId1
          in: path
          required: true
          schema:
            type: integer
        - name: versionId2
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Version differences
          content:
            application/json:
              schema:
                type: object
                properties:
                  changes:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          enum: [added, modified, deleted]
                        object_id:
                          type: string
                        old_value:
                          type: object
                        new_value:
                          type: object

  /versions/data/{versionId}:
    get:
      tags:
        - Version Control
      summary: Get version data
      description: Retrieve data for a specific version (admin/editor/viewer only)
      security:
        - BearerAuth: []
      parameters:
        - name: versionId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Version data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionData'
        '404':
          description: Version not found

  /versions:
    post:
      tags:
        - Version Control
      summary: Create version
      description: Create a new version (admin/editor only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - floor_id
                - name
              properties:
                floor_id:
                  type: integer
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                data:
                  type: object
      responses:
        '201':
          description: Version created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Version'

  /versions/{versionId}/restore:
    post:
      tags:
        - Version Control
      summary: Restore version
      description: Restore a specific version (admin/editor only)
      security:
        - BearerAuth: []
      parameters:
        - name: versionId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                create_backup:
                  type: boolean
                  default: true
                notes:
                  type: string
      responses:
        '200':
          description: Version restored successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  restored_version:
                    $ref: '#/components/schemas/Version'
                  backup_created:
                    type: boolean

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
          additionalProperties: true

    User:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [viewer, editor, admin, maintenance, analyst, auditor, security, monitor]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        services:
          type: object
          additionalProperties:
            type: string
        metrics:
          type: object
          additionalProperties: true
        version:
          type: string
        uptime:
          type: string

    Project:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, inactive, completed, archived]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Building:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        address:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [active, inactive, maintenance, archived]
        owner_id:
          type: integer
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Floor:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        level:
          type: integer
        building_id:
          type: integer
        svg_data:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Wall:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        coordinates:
          type: object
          additionalProperties: true
        properties:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [active, inactive, maintenance, archived]
        assigned_to:
          type: string
        locked:
          type: boolean
        locked_by:
          type: integer
        locked_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Room:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        coordinates:
          type: object
          additionalProperties: true
        properties:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [active, inactive, maintenance, archived]
        assigned_to:
          type: string
        locked:
          type: boolean
        locked_by:
          type: integer
        locked_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Device:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        device_type:
          type: string
        coordinates:
          type: object
          additionalProperties: true
        properties:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [active, inactive, maintenance, archived]
        assigned_to:
          type: string
        locked:
          type: boolean
        locked_by:
          type: integer
        locked_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Label:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        coordinates:
          type: object
          additionalProperties: true
        properties:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [active, inactive, maintenance, archived]
        assigned_to:
          type: string
        locked:
          type: boolean
        locked_by:
          type: integer
        locked_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Zone:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        coordinates:
          type: object
          additionalProperties: true
        properties:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [active, inactive, maintenance, archived]
        assigned_to:
          type: string
        locked:
          type: boolean
        locked_by:
          type: integer
        locked_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Asset:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        asset_type:
          type: string
        building_id:
          type: integer
        location:
          type: string
        status:
          type: string
          enum: [active, inactive, maintenance, retired]
        purchase_date:
          type: string
          format: date
        purchase_cost:
          type: number
        current_value:
          type: number
        warranty_expiry:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CMMSConnection:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        system_type:
          type: string
          enum: [maximo, sap, oracle, custom]
        connection_string:
          type: string
        credentials:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [active, inactive, testing]
        last_sync:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CMMSMapping:
      type: object
      properties:
        id:
          type: integer
        connection_id:
          type: integer
        arx_field:
          type: string
        cmms_field:
          type: string
        field_type:
          type: string
          enum: [string, number, date, boolean]
        is_required:
          type: boolean
        created_at:
          type: string
          format: date-time

    MaintenanceSchedule:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        schedule_type:
          type: string
          enum: [preventive, predictive, corrective]
        frequency:
          type: string
          enum: [daily, weekly, monthly, quarterly, yearly]
        next_due:
          type: string
          format: date-time
        description:
          type: string
        status:
          type: string
          enum: [active, inactive, completed]
        created_at:
          type: string
          format: date-time

    WorkOrder:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        work_order_number:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [low, medium, high, critical]
        status:
          type: string
          enum: [open, in_progress, completed, cancelled]
        assigned_to:
          type: string
        estimated_hours:
          type: number
        actual_hours:
          type: number
        scheduled_start:
          type: string
          format: date-time
        scheduled_end:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    EquipmentSpecification:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        specification_type:
          type: string
          enum: [technical, operational, safety]
        specification_data:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    MaintenanceTask:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        task_type:
          type: string
          enum: [inspection, repair, replacement, calibration]
        description:
          type: string
        priority:
          type: string
          enum: [low, medium, high, critical]
        status:
          type: string
          enum: [pending, in_progress, completed, cancelled]
        assigned_to:
          type: string
        estimated_duration:
          type: number
        actual_duration:
          type: number
        scheduled_date:
          type: string
          format: date-time
        completed_date:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    AssetLifecycle:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        lifecycle_stage:
          type: string
          enum: [planning, acquisition, operation, maintenance, disposal]
        stage_start_date:
          type: string
          format: date
        stage_end_date:
          type: string
          format: date
        notes:
          type: string
        created_at:
          type: string
          format: date-time

    Warranty:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        warranty_type:
          type: string
          enum: [manufacturer, extended, service]
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        terms:
          type: string
        provider:
          type: string
        contact_info:
          type: string
        created_at:
          type: string
          format: date-time

    ReplacementPlan:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        replacement_reason:
          type: string
          enum: [end_of_life, performance, cost, safety]
        planned_date:
          type: string
          format: date
        estimated_cost:
          type: number
        replacement_asset:
          type: string
        status:
          type: string
          enum: [planned, approved, in_progress, completed]
        created_at:
          type: string
          format: date-time

    MaintenanceCost:
      type: object
      properties:
        id:
          type: integer
        asset_id:
          type: integer
        cost_type:
          type: string
          enum: [labor, parts, materials, external]
        amount:
          type: number
        description:
          type: string
        date:
          type: string
          format: date
        work_order_id:
          type: integer
        created_at:
          type: string
          format: date-time

    MaintenanceNotification:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        notification_type:
          type: string
          enum: [schedule_due, work_order_assigned, asset_issue, system_alert]
        title:
          type: string
        message:
          type: string
        priority:
          type: string
          enum: [low, medium, high, critical]
        is_read:
          type: boolean
        related_id:
          type: integer
        created_at:
          type: string
          format: date-time

    MaintenanceDashboard:
      type: object
      properties:
        total_assets:
          type: integer
        assets_in_maintenance:
          type: integer
        pending_tasks:
          type: integer
        completed_tasks:
          type: integer
        total_cost:
          type: number
        average_response_time:
          type: number
        upcoming_schedules:
          type: array
          items:
            $ref: '#/components/schemas/MaintenanceSchedule'
        recent_work_orders:
          type: array
          items:
            $ref: '#/components/schemas/WorkOrder'

    ExportActivity:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        export_type:
          type: string
          enum: [bim, asset, maintenance, compliance]
        format:
          type: string
          enum: [json, xml, csv, pdf, ifc, dxf, svg]
        file_size:
          type: number
        download_count:
          type: integer
        status:
          type: string
          enum: [pending, processing, completed, failed]
        created_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time

    ExportAnalytics:
      type: object
      properties:
        total_exports:
          type: integer
        exports_by_type:
          type: object
          additionalProperties:
            type: integer
        exports_by_format:
          type: object
          additionalProperties:
            type: integer
        average_file_size:
          type: number
        total_downloads:
          type: integer
        popular_exports:
          type: array
          items:
            $ref: '#/components/schemas/ExportActivity'

    DataVendorUsage:
      type: object
      properties:
        id:
          type: integer
        vendor_name:
          type: string
        api_calls:
          type: integer
        data_volume:
          type: number
        cost:
          type: number
        date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time

    AuditLog:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        action_type:
          type: string
          enum: [create, update, delete, access, export, login, logout]
        resource_type:
          type: string
        resource_id:
          type: string
        details:
          type: object
          additionalProperties: true
        ip_address:
          type: string
        user_agent:
          type: string
        created_at:
          type: string
          format: date-time

    ComplianceReport:
      type: object
      properties:
        id:
          type: integer
        report_type:
          type: string
          enum: [data_access, change_history, export_activity, retention]
        period_start:
          type: string
          format: date
        period_end:
          type: string
          format: date
        summary:
          type: object
          additionalProperties: true
        details:
          type: array
          items:
            type: object
        created_at:
          type: string
          format: date-time

    DataRetentionPolicy:
      type: object
      properties:
        id:
          type: integer
        data_type:
          type: string
          enum: [logs, exports, backups, temp_files]
        retention_period:
          type: integer
          description: Retention period in days
        action:
          type: string
          enum: [archive, delete]
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time

    SecurityEvent:
      type: object
      properties:
        id:
          type: integer
        event_type:
          type: string
          enum: [login_failure, suspicious_activity, data_breach, access_denied]
        severity:
          type: string
          enum: [low, medium, high, critical]
        user_id:
          type: integer
        ip_address:
          type: string
        details:
          type: object
          additionalProperties: true
        resolved:
          type: boolean
        resolved_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    Symbol:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        category:
          type: string
        svg_data:
          type: string
        properties:
          type: object
          additionalProperties: true
        tags:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ChatMessage:
      type: object
      properties:
        id:
          type: integer
        building_id:
          type: integer
        user_id:
          type: integer
        message:
          type: string
        message_type:
          type: string
          enum: [text, system, alert]
        created_at:
          type: string
          format: date-time

    Comment:
      type: object
      properties:
        id:
          type: integer
        object_id:
          type: string
        user_id:
          type: integer
        content:
          type: string
        comment_type:
          type: string
          enum: [general, issue, note]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Drawing:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        building_id:
          type: integer
        floor_id:
          type: integer
        drawing_type:
          type: string
          enum: [floor_plan, elevation, section, detail, as_built]
        scale:
          type: number
          minimum: 0.1
          maximum: 100.0
        units:
          type: string
          enum: [mm, cm, m, inch, ft]
        file_path:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Markup:
      type: object
      properties:
        id:
          type: integer
        markup_data:
          type: object
          additionalProperties: true
        object_id:
          type: integer
        markup_type:
          type: string
          enum: [annotation, correction, addition, deletion]
        notes:
          type: string
        user_id:
          type: integer
        status:
          type: string
          enum: [pending, approved, rejected]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Route:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        start_point:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
            floor_id:
              type: integer
        end_point:
          type: object
          properties:
            x:
              type: number
            y:
              type: number
            floor_id:
              type: integer
        route_type:
          type: string
          enum: [evacuation, maintenance, visitor, emergency]
        waypoints:
          type: array
          items:
            type: object
            properties:
              x:
                type: number
              y:
                type: number
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ObjectInfo:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        type:
          type: string
          enum: [wall, room, device, asset, building]
        properties:
          type: object
          additionalProperties: true
        coordinates:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [active, inactive, maintenance, archived]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SVGObject:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        svg_data:
          type: string
        properties:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    BuildingLog:
      type: object
      properties:
        id:
          type: integer
        building_id:
          type: integer
        log_type:
          type: string
          enum: [system, user, maintenance, security]
        message:
          type: string
        user_id:
          type: integer
        details:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    LogEntry:
      type: object
      properties:
        id:
          type: integer
        building_id:
          type: integer
        log_type:
          type: string
          enum: [access, change, error, system]
        message:
          type: string
        user_id:
          type: integer
        details:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    Version:
      type: object
      properties:
        id:
          type: integer
        floor_id:
          type: integer
        name:
          type: string
        description:
          type: string
        version_number:
          type: integer
        created_by:
          type: integer
        created_at:
          type: string
          format: date-time

    VersionData:
      type: object
      properties:
        version_id:
          type: integer
        floor_data:
          type: object
          additionalProperties: true
        objects:
          type: array
          items:
            type: object
            additionalProperties: true
        metadata:
          type: object
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    Category:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UserCategoryPermission:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        category_id:
          type: integer
        permission_level:
          type: string
          enum: [read, write, admin]
        created_at:
          type: string
          format: date-time

    Pagination:
      type: object
      properties:
        page:
          type: integer
        limit:
          type: integer
        total:
          type: integer
        total_pages:
          type: integer
        has_next:
          type: boolean
        has_prev:
          type: boolean
