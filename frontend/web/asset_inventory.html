<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asset Inventory Management</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="static/js/session.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <header class="bg-white shadow p-4 flex items-center justify-between">
    <h1 class="text-2xl font-bold text-gray-800">Asset Inventory</h1>
    <a href="index.html" class="text-blue-600 hover:underline">Back to Dashboard</a>
  </header>
  <main class="flex-1 p-6 flex flex-col gap-6">
    <!-- Summary and Analytics Dashboard -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800">Total Assets</h3>
        <p class="text-3xl font-bold text-blue-600" id="total-assets">0</p>
        <p class="text-sm text-gray-500" id="total-assets-building"></p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800">Total Value</h3>
        <p class="text-3xl font-bold text-green-600" id="total-value">$0</p>
        <p class="text-sm text-gray-500">Estimated</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800">Avg Age</h3>
        <p class="text-3xl font-bold text-orange-600" id="avg-age">0</p>
        <p class="text-sm text-gray-500">Years</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800">Active Assets</h3>
        <p class="text-3xl font-bold text-purple-600" id="active-assets">0</p>
        <p class="text-sm text-gray-500" id="active-percentage"></p>
      </div>
    </div>
    <!-- Interactive Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Asset Distribution by System</h3>
        <canvas id="system-chart" width="400" height="200"></canvas>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Asset Age Distribution</h3>
        <canvas id="age-chart" width="400" height="200"></canvas>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Efficiency Ratings</h3>
        <canvas id="efficiency-chart" width="400" height="200"></canvas>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Maintenance Costs Trends</h3>
        <canvas id="maintenance-chart" width="400" height="200"></canvas>
      </div>
    </div>
    <!-- Search & Filter Bar -->
    <div class="flex flex-wrap gap-4 items-end bg-white p-4 rounded shadow">
      <div>
        <label class="block text-gray-700 text-sm mb-1">Building</label>
        <select id="filter-building" class="border rounded p-2" hx-get="/api/buildings" hx-trigger="load" hx-target="#filter-building" hx-swap="outerHTML"></select>
      </div>
      <div>
        <label class="block text-gray-700 text-sm mb-1">System</label>
        <input id="filter-system" type="text" class="border rounded p-2" placeholder="e.g. HVAC">
      </div>
      <div>
        <label class="block text-gray-700 text-sm mb-1">Asset Type</label>
        <input id="filter-asset-type" type="text" class="border rounded p-2" placeholder="e.g. Chiller">
      </div>
      <div>
        <label class="block text-gray-700 text-sm mb-1">Room</label>
        <input id="filter-room" type="text" class="border rounded p-2" placeholder="Room #">
      </div>
      <div>
        <label class="block text-gray-700 text-sm mb-1">Status</label>
        <select id="filter-status" class="border rounded p-2">
          <option value="">All</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
          <option value="retired">Retired</option>
        </select>
      </div>
      <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition" onclick="loadAssets()">Search</button>
      <button class="ml-auto bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition" onclick="openAssetModal()">+ Add Asset</button>
    </div>
    <!-- Bulk Actions Bar -->
    <div class="flex gap-4 items-center bg-white p-3 rounded shadow">
      <button class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300" onclick="exportAssets('csv')">Export CSV</button>
      <button class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300" onclick="exportAssets('json')">Export JSON</button>
      <button class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300" onclick="deleteSelectedAssets()">Delete Selected</button>
      <span class="ml-auto text-sm text-gray-500" id="asset-count"></span>
    </div>
    <!-- Export Configuration Panel -->
    <div class="bg-white p-4 rounded shadow flex flex-wrap gap-4 items-end">
      <div>
        <label class="block text-gray-700 text-sm mb-1">Export Format</label>
        <select id="export-format" class="border rounded p-2">
          <option value="csv">CSV</option>
          <option value="json">JSON</option>
          <option value="xml">XML</option>
          <option value="pdf">PDF</option>
        </select>
      </div>
      <div>
        <label class="block text-gray-700 text-sm mb-1">System</label>
        <input id="export-system" type="text" class="border rounded p-2" placeholder="e.g. HVAC">
      </div>
      <div>
        <label class="block text-gray-700 text-sm mb-1">Status</label>
        <select id="export-status" class="border rounded p-2">
          <option value="">All</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
          <option value="retired">Retired</option>
        </select>
      </div>
      <div>
        <label class="block text-gray-700 text-sm mb-1">Date Range</label>
        <input id="export-date-from" type="date" class="border rounded p-2"> -
        <input id="export-date-to" type="date" class="border rounded p-2">
      </div>
      <div class="flex flex-col">
        <label class="block text-gray-700 text-sm mb-1">Include</label>
        <label><input type="checkbox" id="export-include-history" checked> History</label>
        <label><input type="checkbox" id="export-include-maintenance" checked> Maintenance</label>
        <label><input type="checkbox" id="export-include-valuations" checked> Valuations</label>
      </div>
      <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition" onclick="exportAssetsAdvanced()">Export</button>
      <span id="export-progress" class="ml-4 text-sm text-gray-500"></span>
    </div>
    <!-- Export History/Queue Placeholder -->
    <div class="bg-white p-4 rounded shadow mt-2">
      <h3 class="font-semibold mb-2">Export History / Queue</h3>
      <div id="export-history">(Coming soon)</div>
      <div id="export-schedule" class="mt-2">(Export scheduling UI coming soon)</div>
    </div>
    <!-- Asset Listing Table -->
    <div class="overflow-x-auto bg-white rounded shadow">
      <table class="min-w-full divide-y divide-gray-200" id="asset-table">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-2"><input type="checkbox" id="select-all-assets" onclick="toggleSelectAllAssets()"></th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('id')">ID</th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('asset_type')">Type</th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('system')">System</th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('room')">Room</th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('age')">Age</th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('efficiency_rating')">Efficiency</th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('status')">Status</th>
            <th class="px-4 py-2 cursor-pointer" onclick="sortAssets('estimated_value')">Value</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="asset-table-body">
          <!-- Asset rows will be loaded here -->
        </tbody>
      </table>
      <!-- Pagination Controls -->
      <div class="flex justify-between items-center p-2">
        <button id="prev-page" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300" onclick="prevPage()">Previous</button>
        <span id="page-info" class="text-sm text-gray-600"></span>
        <button id="next-page" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300" onclick="nextPage()">Next</button>
      </div>
    </div>
    <!-- Asset Detail Modal/Sidebar (hidden by default) -->
    <div id="asset-modal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-lg w-full max-w-2xl p-6 relative">
        <button class="absolute top-2 right-2 text-gray-500 hover:text-gray-700" onclick="closeAssetModal()">&times;</button>
        <h2 class="text-xl font-bold mb-4" id="asset-modal-title">Asset Details</h2>
        <form id="asset-form" class="space-y-4">
          <!-- Asset specifications form fields will be injected here -->
        </form>
        <div class="mt-6">
          <div class="flex gap-4 border-b mb-2">
            <button type="button" class="tab-btn" onclick="showAssetTab('history')">History</button>
            <button type="button" class="tab-btn" onclick="showAssetTab('maintenance')">Maintenance</button>
            <button type="button" class="tab-btn" onclick="showAssetTab('valuation')">Valuation</button>
            <button type="button" class="tab-btn" onclick="showAssetTab('documents')">Documents</button>
            <button type="button" class="ml-auto bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700" onclick="addAssetFromSymbol()">Add from Symbol Placement</button>
          </div>
          <div id="asset-tab-history" class="asset-tab-content">
            <h3 class="font-semibold mb-2">History Timeline</h3>
            <div id="asset-history-timeline" class="bg-gray-50 p-2 rounded h-24 overflow-y-auto"></div>
          </div>
          <div id="asset-tab-maintenance" class="asset-tab-content hidden">
            <h3 class="font-semibold mb-2">Maintenance Records</h3>
            <div id="asset-maintenance-records" class="bg-gray-50 p-2 rounded h-24 overflow-y-auto"></div>
          </div>
          <div id="asset-tab-valuation" class="asset-tab-content hidden">
            <h3 class="font-semibold mb-2">Valuation History</h3>
            <div id="asset-valuation-history" class="bg-gray-50 p-2 rounded h-24 overflow-y-auto"></div>
          </div>
          <div id="asset-tab-documents" class="asset-tab-content hidden">
            <h3 class="font-semibold mb-2">Related Documents</h3>
            <div id="asset-documents" class="bg-gray-50 p-2 rounded h-16 overflow-y-auto"></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Toast/Notification Area -->
    <div id="toast-area" class="fixed bottom-4 right-4 z-50 flex flex-col gap-2"></div>
  </main>
  
  <!-- ArxLogger Script -->
  <script src="static/js/arx-logger.js"></script>
  <script>
    // Initialize ArxLogger with asset management context
    document.addEventListener('DOMContentLoaded', function() {
      // Get asset management context from URL parameters or localStorage
      const urlParams = new URLSearchParams(window.location.search);
      const buildingId = urlParams.get('building_id') || localStorage.getItem('arx_building_id') || 'unknown';
      const floorId = urlParams.get('floor_id') || localStorage.getItem('arx_floor_id') || 'unknown';
      const userId = localStorage.getItem('arx_user_id') || 'unknown';
      
      // Set context for asset management operations
      if (window.arxLogger) {
        window.arxLogger.setContext({
          buildingId: buildingId,
          floorId: floorId,
          userId: userId,
          correlationId: window.arxLogger.generateCorrelationId()
        });
        
        window.arxLogger.info('Asset Inventory page initialized with context', {
          building_id: buildingId,
          floor_id: floorId,
          user_id: userId,
          page: 'asset_inventory'
        });
      }
    });
  </script>
  
  <script src="static/js/asset_inventory.js"></script>
</body>
</html> 