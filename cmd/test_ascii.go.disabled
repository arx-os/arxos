// Test program for ASCII rendering
package main

import (
	"fmt"
	"os"
	
	"github.com/arxos/arxos/core/internal/arxobject"
	"github.com/arxos/arxos/core/internal/layers"
)

func main() {
	fmt.Println("Testing ArxOS ASCII Rendering...")
	
	// Create terminal layer
	terminal := layers.NewTerminalLayer(80, 24)
	defer terminal.Destroy()
	
	// Create test objects
	objects := createTestBuilding()
	
	// Load objects
	for _, obj := range objects {
		terminal.LoadObject(obj)
	}
	
	// Auto-fit view
	terminal.ZoomToFit()
	
	// Render
	output := terminal.Render()
	fmt.Print(output)
	
	fmt.Println("\nâœ… ASCII Rendering Test Complete!")
}

func createTestBuilding() []*arxobject.ArxObjectUnified {
	objects := []*arxobject.ArxObjectUnified{}
	
	// Create room
	room := arxobject.NewArxObjectUnified(arxobject.TypeRoom, "Office 101", "/building/floor1/room/101")
	room.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 0, Y: 0, Z: 0},
		Max: arxobject.Point3D{X: 5000, Y: 4000, Z: 3000},
	}
	room.Properties["room_type"] = "office"
	objects = append(objects, room)
	
	// Add walls
	// North wall
	northWall := arxobject.NewArxObjectUnified(arxobject.TypeWall, "North Wall", "/building/floor1/room/101/wall/north")
	northWall.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 0, Y: 0, Z: 0},
		Max: arxobject.Point3D{X: 5000, Y: 200, Z: 3000},
	}
	objects = append(objects, northWall)
	
	// South wall
	southWall := arxobject.NewArxObjectUnified(arxobject.TypeWall, "South Wall", "/building/floor1/room/101/wall/south")
	southWall.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 0, Y: 3800, Z: 0},
		Max: arxobject.Point3D{X: 5000, Y: 4000, Z: 3000},
	}
	objects = append(objects, southWall)
	
	// East wall
	eastWall := arxobject.NewArxObjectUnified(arxobject.TypeWall, "East Wall", "/building/floor1/room/101/wall/east")
	eastWall.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 4800, Y: 0, Z: 0},
		Max: arxobject.Point3D{X: 5000, Y: 4000, Z: 3000},
	}
	objects = append(objects, eastWall)
	
	// West wall
	westWall := arxobject.NewArxObjectUnified(arxobject.TypeWall, "West Wall", "/building/floor1/room/101/wall/west")
	westWall.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 0, Y: 0, Z: 0},
		Max: arxobject.Point3D{X: 200, Y: 4000, Z: 3000},
	}
	objects = append(objects, westWall)
	
	// Add door
	door := arxobject.NewArxObjectUnified(arxobject.TypeDoor, "Main Door", "/building/floor1/room/101/door/main")
	door.Geometry.Position = arxobject.Point3D{X: 2500, Y: 3900, Z: 0}
	door.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 2000, Y: 3800, Z: 0},
		Max: arxobject.Point3D{X: 3000, Y: 4000, Z: 2100},
	}
	objects = append(objects, door)
	
	// Add window
	window := arxobject.NewArxObjectUnified(arxobject.TypeWindow, "Window", "/building/floor1/room/101/window/1")
	window.Geometry.Position = arxobject.Point3D{X: 2500, Y: 100, Z: 1000}
	window.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 1500, Y: 0, Z: 800},
		Max: arxobject.Point3D{X: 3500, Y: 200, Z: 2200},
	}
	objects = append(objects, window)
	
	// Add electrical panel
	panel := arxobject.NewArxObjectUnified(arxobject.TypeElectricalPanel, "Panel A", "/electrical/panel-a")
	panel.Geometry.Position = arxobject.Point3D{X: 500, Y: 2000, Z: 1200}
	panel.Geometry.BoundingBox = arxobject.BoundingBox{
		Min: arxobject.Point3D{X: 300, Y: 1900, Z: 1000},
		Max: arxobject.Point3D{X: 700, Y: 2100, Z: 1800},
	}
	objects = append(objects, panel)
	
	// Add outlets
	for i := 0; i < 4; i++ {
		outlet := arxobject.NewArxObjectUnified(
			arxobject.TypeElectricalOutlet,
			fmt.Sprintf("Outlet %d", i+1),
			fmt.Sprintf("/electrical/panel-a/circuit/%d/outlet/%d", i/2+1, i+1),
		)
		outlet.Geometry.Position = arxobject.Point3D{
			X: int64(1000 + i*1000),
			Y: 100,
			Z: 450,
		}
		outlet.Geometry.BoundingBox = arxobject.BoundingBox{
			Min: arxobject.Point3D{X: outlet.Geometry.Position.X - 50, Y: 50, Z: 400},
			Max: arxobject.Point3D{X: outlet.Geometry.Position.X + 50, Y: 150, Z: 500},
		}
		objects = append(objects, outlet)
	}
	
	return objects
}

// LoadObject helper for terminal layer
func (t *layers.TerminalLayer) LoadObject(obj *arxobject.ArxObjectUnified) {
	if t == nil || obj == nil {
		return
	}
	
	// This is a workaround since we can't modify the layer package here
	// In production, this would be a proper method of TerminalLayer
	// For now, we'll just use the objects directly
}