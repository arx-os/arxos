class SharedUtilities{constructor(options={}){this.options={enableNotifications:true,notificationDuration:5000,maxFileSize:50*1024*1024,supportedFormats:['json','svg','zip','pdf'],...options};this.notificationQueue=[];this.isProcessingNotifications=false;this.initializeNotificationSystem();}
async readFileAsText(file){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=(e)=>resolve(e.target.result);reader.onerror=(e)=>reject(new Error('Failed to read file'));reader.readAsText(file);});}
async readFileAsArrayBuffer(file){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.onload=(e)=>resolve(e.target.result);reader.onerror=(e)=>reject(new Error('Failed to read file'));reader.readAsArrayBuffer(file);});}
getFileExtension(filename){return filename.split('.').pop().toLowerCase();}
validateFileType(file,allowedTypes=this.options.supportedFormats){const extension=this.getFileExtension(file.name);return allowedTypes.includes(extension);}
validateFileSize(file,maxSize=this.options.maxFileSize){return file.size<=maxSize;}
async downloadFile(data,filename,mimeType='application/octet-stream'){const blob=new Blob([data],{type:mimeType});const url=URL.createObjectURL(blob);const link=document.createElement('a');link.href=url;link.download=filename;document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);}
async downloadJSON(data,filename){const jsonString=JSON.stringify(data,null,2);await this.downloadFile(jsonString,filename,'application/json');}
async downloadSVG(svgContent,filename){await this.downloadFile(svgContent,filename,'image/svg+xml');}
async downloadZIP(zipData,filename){await this.downloadFile(zipData,filename,'application/zip');}
initializeNotificationSystem(){if(!this.options.enableNotifications)return;let container=document.getElementById('shared-notifications');if(!container){container=document.createElement('div');container.id='shared-notifications';container.className='shared-notifications-container';container.style.cssText=`
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 400px;
            `;document.body.appendChild(container);}
this.notificationContainer=container;}
showNotification(message,type='info',duration=this.options.notificationDuration){if(!this.options.enableNotifications){console.log(`[${type.toUpperCase()}] ${message}`);return;}
const notification=this.createNotificationElement(message,type);this.notificationContainer.appendChild(notification);setTimeout(()=>{if(notification.parentElement){notification.remove();}},duration);return notification;}
createNotificationElement(message,type){const notification=document.createElement('div');notification.className=`shared-notification shared-notification-${type}`;notification.style.cssText=`
            background: ${this.getNotificationColor(type)};
            color: white;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            font-size: 14px;
            line-height: 1.4;
            max-width: 100%;
            word-wrap: break-word;
            animation: slideInRight 0.3s ease-out;
        `;notification.innerHTML=`
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <span>${this.escapeHtml(message)}</span>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="background: none; border: none; color: white; cursor: pointer; margin-left: 8px; font-size: 16px;">
                    Ã—
                </button>
            </div>
        `;return notification;}
getNotificationColor(type){const colors={success:'#10b981',error:'#ef4444',warning:'#f59e0b',info:'#3b82f6'};return colors[type]||colors.info;}
escapeHtml(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML;}
validateEmail(email){const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return emailRegex.test(email);}
validateRequiredFields(data,requiredFields){const missing=[];for(const field of requiredFields){if(!data[field]||data[field].toString().trim()===''){missing.push(field);}}
return missing;}
generateRandomString(length=8){const chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let result='';for(let i=0;i<length;i++){result+=chars.charAt(Math.floor(Math.random()*chars.length));}
return result;}
formatFileSize(bytes){if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i];}
formatDate(date,format='YYYY-MM-DD HH:mm:ss'){const d=new Date(date);const year=d.getFullYear();const month=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');const hours=String(d.getHours()).padStart(2,'0');const minutes=String(d.getMinutes()).padStart(2,'0');const seconds=String(d.getSeconds()).padStart(2,'0');return format.replace('YYYY',year).replace('MM',month).replace('DD',day).replace('HH',hours).replace('mm',minutes).replace('ss',seconds);}
handleError(error,context=''){const errorMessage=error.message||error.toString();console.error(`[${context}] Error:`,error);this.showNotification(`Error: ${errorMessage}`,'error');return{success:false,error:errorMessage};}
async retryOperation(operation,maxRetries=3,baseDelay=1000){for(let attempt=1;attempt<=maxRetries;attempt++){try{return await operation();}catch(error){if(attempt===maxRetries){throw error;}
const delay=baseDelay*Math.pow(2,attempt-1);await new Promise(resolve=>setTimeout(resolve,delay));}}}
debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}
throttle(func,limit){let inThrottle;return function(){const args=arguments;const context=this;if(!inThrottle){func.apply(context,args);inThrottle=true;setTimeout(()=>inThrottle=false,limit);}};}}
window.sharedUtilities=new SharedUtilities();if(typeof module!=='undefined'&&module.exports){module.exports=SharedUtilities;}