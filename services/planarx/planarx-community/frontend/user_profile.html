<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile - Planarx Community</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .profile-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .profile-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid white;
            object-fit: cover;
            margin-bottom: 20px;
        }

        .reputation-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .reputation-card:hover {
            transform: translateY(-5px);
        }

        .reputation-tier {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tier-newcomer { background: #e3f2fd; color: #1976d2; }
        .tier-contributor { background: #e8f5e8; color: #388e3c; }
        .tier-regular { background: #fff3e0; color: #f57c00; }
        .tier-expert { background: #fce4ec; color: #c2185b; }
        .tier-master { background: #f3e5f5; color: #7b1fa2; }
        .tier-legend { background: linear-gradient(45deg, #ffd700, #ffed4e); color: #b8860b; }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
        }

        .progress-ring .background {
            stroke: #e0e0e0;
        }

        .progress-ring .progress {
            stroke: #4caf50;
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }

        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .badge-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .badge-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .badge-card.earned {
            border: 2px solid #4caf50;
        }

        .badge-card.locked {
            opacity: 0.6;
            filter: grayscale(1);
        }

        .badge-icon {
            font-size: 48px;
            margin-bottom: 15px;
            display: block;
        }

        .badge-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .rarity-common { background: #e0e0e0; color: #424242; }
        .rarity-uncommon { background: #4caf50; color: white; }
        .rarity-rare { background: #2196f3; color: white; }
        .rarity-epic { background: #9c27b0; color: white; }
        .rarity-legendary { background: linear-gradient(45deg, #ffd700, #ffed4e); color: #b8860b; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2196f3;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .activity-timeline {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .timeline-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .timeline-item:last-child {
            border-bottom: none;
        }

        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
            color: white;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .timeline-time {
            color: #666;
            font-size: 12px;
        }

        .privileges-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .privilege-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .privilege-item:last-child {
            border-bottom: none;
        }

        .privilege-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #4caf50;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 12px;
        }

        .recommendations-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .recommendation-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }

        .recommendation-progress {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .recommendation-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #2196f3, #4caf50);
            transition: width 0.3s ease;
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            max-width: 400px;
            display: none;
        }

        .achievement-popup.show {
            display: block;
            animation: achievementSlideIn 0.5s ease;
        }

        @keyframes achievementSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        .level-up-animation {
            animation: levelUp 1s ease;
        }

        @keyframes levelUp {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .badge-unlock-animation {
            animation: badgeUnlock 0.8s ease;
        }

        @keyframes badgeUnlock {
            0% { transform: scale(0.5) rotate(0deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="profile-container">
        <!-- Profile Header -->
        <div class="profile-header">
            <div class="row align-items-center">
                <div class="col-md-3 text-center">
                    <img src="https://via.placeholder.com/120" alt="User Avatar" class="profile-avatar">
                </div>
                <div class="col-md-9">
                    <h1 id="user-name">John Doe</h1>
                    <p class="mb-3" id="user-bio">Building the future of construction technology</p>
                    <div class="d-flex align-items-center mb-3">
                        <span class="reputation-tier tier-expert" id="user-tier">Expert</span>
                        <span class="ms-3 text-white-50">Member since <span id="member-since">January 2024</span></span>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center">
                                <div class="progress-ring">
                                    <svg>
                                        <circle class="background" cx="60" cy="60" r="52"></circle>
                                        <circle class="progress" cx="60" cy="60" r="52" id="tier-progress"></circle>
                                    </svg>
                                </div>
                                <div class="text-white">
                                    <div class="h4 mb-0" id="current-points">1,250</div>
                                    <small>points in tier</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-6">
                                    <div class="text-white text-center">
                                        <div class="h5 mb-0" id="total-points">1,250</div>
                                        <small>Total Points</small>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="text-white text-center">
                                        <div class="h5 mb-0" id="badge-count">12</div>
                                        <small>Badges Earned</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="drafts-submitted">45</div>
                <div class="stat-label">Drafts Submitted</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="comments-made">128</div>
                <div class="stat-label">Comments Made</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="threads-resolved">23</div>
                <div class="stat-label">Threads Resolved</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="collaboration-sessions">67</div>
                <div class="stat-label">Collaboration Sessions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="funding-contributions">15</div>
                <div class="stat-label">Funding Contributions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="consecutive-days">28</div>
                <div class="stat-label">Consecutive Days</div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column -->
            <div class="col-md-8">
                <!-- Badges Section -->
                <div class="reputation-card">
                    <h3><i class="fas fa-medal"></i> Badges & Achievements</h3>
                    <div class="badge-grid" id="badge-grid">
                        <!-- Badges will be populated here -->
                    </div>
                </div>

                <!-- Activity Timeline -->
                <div class="activity-timeline">
                    <h3><i class="fas fa-history"></i> Recent Activity</h3>
                    <div id="activity-timeline">
                        <!-- Activity items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-md-4">
                <!-- Privileges Section -->
                <div class="privileges-section">
                    <h3><i class="fas fa-crown"></i> Privileges</h3>
                    <div id="privileges-list">
                        <!-- Privileges will be populated here -->
                    </div>
                </div>

                <!-- Recommendations Section -->
                <div class="recommendations-section">
                    <h3><i class="fas fa-lightbulb"></i> Badge Recommendations</h3>
                    <div id="recommendations-list">
                        <!-- Recommendations will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="overlay" id="overlay"></div>
    <div class="achievement-popup" id="achievement-popup">
        <div class="badge-icon" id="popup-badge-icon">üèÜ</div>
        <h4 id="popup-badge-name">New Badge Unlocked!</h4>
        <p id="popup-badge-description">You've earned a new badge for your contributions.</p>
        <button class="btn btn-primary" onclick="closeAchievementPopup()">Continue</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class UserProfile {
            constructor() {
                this.userId = new URLSearchParams(window.location.search).get('user_id') || 'current';
                this.userData = null;
                this.badges = [];
                this.recommendations = [];

                this.initialize();
            }

            async initialize() {
                await this.loadUserData();
                this.setupEventListeners();
                this.renderProfile();
                this.setupAnimations();
            }

            async loadUserData() {
                try {
                    // Load user profile data
                    const response = await fetch(`/reputation/profile/${this.userId}`);
                    const data = await response.json();

                    if (data.success) {
                        this.userData = data.profile;
                        this.badges = data.badges;
                        this.recommendations = data.recommendations;
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    // Load mock data for demo
                    this.loadMockData();
                }
            }

            loadMockData() {
                this.userData = {
                    user_id: "user-123",
                    display_name: "John Doe",
                    bio: "Building the future of construction technology",
                    member_since: "January 2024",
                    total_points: 1250,
                    current_tier: "expert",
                    tier_points: 250,
                    contribution_count: 156,
                    last_activity: "2024-01-15T10:30:00Z",
                    privileges: [
                        "moderate_comments",
                        "assign_threads",
                        "priority_support",
                        "collaboration_access"
                    ],
                    stats: {
                        drafts_submitted: 45,
                        comments_made: 128,
                        threads_resolved: 23,
                        collaboration_sessions: 67,
                        funding_contributions: 15,
                        consecutive_days: 28
                    }
                };

                this.badges = [
                    {
                        badge_id: "contributor",
                        earned_at: "2024-01-01T00:00:00Z",
                        progress: 1.0,
                        badge_details: {
                            name: "Contributor",
                            description: "Made your first contribution to the community",
                            icon: "üåü",
                            color: "#4CAF50",
                            rarity: "common"
                        }
                    },
                    {
                        badge_id: "expert",
                        earned_at: "2024-01-10T00:00:00Z",
                        progress: 1.0,
                        badge_details: {
                            name: "Expert",
                            description: "Reached expert level through consistent contributions",
                            icon: "‚≠ê",
                            color: "#2196F3",
                            rarity: "uncommon"
                        }
                    },
                    {
                        badge_id: "comment_king",
                        earned_at: "2024-01-12T00:00:00Z",
                        progress: 1.0,
                        badge_details: {
                            name: "Comment King",
                            description: "Made 100+ helpful comments",
                            icon: "üí¨",
                            color: "#607D8B",
                            rarity: "uncommon"
                        }
                    }
                ];

                this.recommendations = [
                    {
                        badge_id: "master",
                        badge_details: {
                            name: "Master",
                            description: "Achieved master status in the community",
                            icon: "üëë",
                            color: "#FF9800"
                        },
                        progress: 0.75,
                        remaining_effort: {
                            "reputation_tier": 1
                        }
                    },
                    {
                        badge_id: "helper",
                        badge_details: {
                            name: "Helper",
                            description: "Helped resolve 25+ threads",
                            icon: "ü§ù",
                            color: "#4CAF50"
                        },
                        progress: 0.92,
                        remaining_effort: {
                            "threads_resolved": 2
                        }
                    }
                ];
            }

            setupEventListeners() {
                // Badge click events
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.badge-card')) {
                        const badgeCard = e.target.closest('.badge-card');
                        const badgeId = badgeCard.dataset.badgeId;
                        this.showBadgeDetails(badgeId);
                    }
                });
            }

            renderProfile() {
                this.renderUserInfo();
                this.renderReputationProgress();
                this.renderStats();
                this.renderBadges();
                this.renderActivityTimeline();
                this.renderPrivileges();
                this.renderRecommendations();
            }

            renderUserInfo() {
                document.getElementById('user-name').textContent = this.userData.display_name;
                document.getElementById('user-bio').textContent = this.userData.bio;
                document.getElementById('member-since').textContent = this.userData.member_since;

                const tierElement = document.getElementById('user-tier');
                tierElement.textContent = this.userData.current_tier.charAt(0).toUpperCase() + this.userData.current_tier.slice(1);
                tierElement.className = `reputation-tier tier-${this.userData.current_tier}`;

                document.getElementById('total-points').textContent = this.userData.total_points.toLocaleString();
                document.getElementById('current-points').textContent = this.userData.tier_points.toLocaleString();
                document.getElementById('badge-count').textContent = this.badges.length;
            }

            renderReputationProgress() {
                // Calculate progress percentage
                const currentTier = this.userData.current_tier;
                const tierThresholds = {
                    newcomer: 0,
                    contributor: 100,
                    regular: 500,
                    expert: 1000,
                    master: 2500,
                    legend: 5000
                };

                const currentThreshold = tierThresholds[currentTier];
                const nextThreshold = Object.values(tierThresholds).find(t => t > currentThreshold) || currentThreshold;
                const progress = (this.userData.tier_points / (nextThreshold - currentThreshold)) * 100;

                // Update progress ring
                const progressCircle = document.getElementById('tier-progress');
                const circumference = 2 * Math.PI * 52;
                const progressOffset = circumference - (progress / 100) * circumference;

                progressCircle.style.strokeDasharray = circumference;
                progressCircle.style.strokeDashoffset = progressOffset;
            }

            renderStats() {
                const stats = this.userData.stats;

                document.getElementById('drafts-submitted').textContent = stats.drafts_submitted;
                document.getElementById('comments-made').textContent = stats.comments_made;
                document.getElementById('threads-resolved').textContent = stats.threads_resolved;
                document.getElementById('collaboration-sessions').textContent = stats.collaboration_sessions;
                document.getElementById('funding-contributions').textContent = stats.funding_contributions;
                document.getElementById('consecutive-days').textContent = stats.consecutive_days;
            }

            renderBadges() {
                const badgeGrid = document.getElementById('badge-grid');
                badgeGrid.innerHTML = '';

                // Get all available badges (in real implementation, this would come from API)
                const allBadges = this.getAllBadges();

                allBadges.forEach(badge => {
                    const earnedBadge = this.badges.find(b => b.badge_id === badge.id);
                    const isEarned = !!earnedBadge;

                    const badgeCard = document.createElement('div');
                    badgeCard.className = `badge-card ${isEarned ? 'earned' : 'locked'}`;
                    badgeCard.dataset.badgeId = badge.id;

                    badgeCard.innerHTML = `
                        <div class="badge-rarity rarity-${badge.rarity}">${badge.rarity}</div>
                        <div class="badge-icon" style="color: ${badge.color}">${badge.icon}</div>
                        <h5>${badge.name}</h5>
                        <p class="text-muted small">${badge.description}</p>
                        ${isEarned ?
                            `<small class="text-success"><i class="fas fa-check"></i> Earned ${new Date(earnedBadge.earned_at).toLocaleDateString()}</small>` :
                            `<small class="text-muted">Not yet earned</small>`
                        }
                    `;

                    badgeGrid.appendChild(badgeCard);
                });
            }

            getAllBadges() {
                // Mock data for all available badges
                return [
                    { id: "contributor", name: "Contributor", description: "Made your first contribution", icon: "üåü", color: "#4CAF50", rarity: "common" },
                    { id: "expert", name: "Expert", description: "Reached expert level", icon: "‚≠ê", color: "#2196F3", rarity: "uncommon" },
                    { id: "master", name: "Master", description: "Achieved master status", icon: "üëë", color: "#FF9800", rarity: "rare" },
                    { id: "legend", name: "Legend", description: "Became a legend", icon: "üèÜ", color: "#E91E63", rarity: "legendary" },
                    { id: "comment_king", name: "Comment King", description: "Made 100+ helpful comments", icon: "üí¨", color: "#607D8B", rarity: "uncommon" },
                    { id: "helper", name: "Helper", description: "Helped resolve 25+ threads", icon: "ü§ù", color: "#4CAF50", rarity: "uncommon" },
                    { id: "moderator", name: "Moderator", description: "Performed 50+ moderation actions", icon: "üõ°Ô∏è", color: "#FF5722", rarity: "rare" },
                    { id: "collaborator", name: "Collaborator", description: "Participated in 20+ sessions", icon: "üë•", color: "#2196F3", rarity: "uncommon" },
                    { id: "funder", name: "Funder", description: "Contributed to 10+ projects", icon: "üí∞", color: "#FFC107", rarity: "uncommon" },
                    { id: "milestone_champion", name: "Milestone Champion", description: "Reached 10+ milestones", icon: "üéØ", color: "#E91E63", rarity: "rare" },
                    { id: "quality_controller", name: "Quality Controller", description: "Maintained high standards", icon: "‚ú®", color: "#9C27B0", rarity: "epic" },
                    { id: "community_builder", name: "Community Builder", description: "Built strong connections", icon: "üèóÔ∏è", color: "#795548", rarity: "epic" }
                ];
            }

            renderActivityTimeline() {
                const timeline = document.getElementById('activity-timeline');
                timeline.innerHTML = '';

                // Mock activity data
                const activities = [
                    { type: "draft_submitted", title: "Submitted new draft", time: "2 hours ago", icon: "üìù", color: "#4CAF50" },
                    { type: "comment_added", title: "Added helpful comment", time: "4 hours ago", icon: "üí¨", color: "#2196F3" },
                    { type: "thread_resolved", title: "Resolved discussion thread", time: "1 day ago", icon: "‚úÖ", color: "#4CAF50" },
                    { type: "badge_earned", title: "Earned Comment King badge", time: "2 days ago", icon: "üèÜ", color: "#FF9800" },
                    { type: "collaboration", title: "Joined collaboration session", time: "3 days ago", icon: "üë•", color: "#9C27B0" }
                ];

                activities.forEach(activity => {
                    const item = document.createElement('div');
                    item.className = 'timeline-item';

                    item.innerHTML = `
                        <div class="timeline-icon" style="background-color: ${activity.color}">
                            ${activity.icon}
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-title">${activity.title}</div>
                            <div class="timeline-time">${activity.time}</div>
                        </div>
                    `;

                    timeline.appendChild(item);
                });
            }

            renderPrivileges() {
                const privilegesList = document.getElementById('privileges-list');
                privilegesList.innerHTML = '';

                this.userData.privileges.forEach(privilege => {
                    const item = document.createElement('div');
                    item.className = 'privilege-item';

                    item.innerHTML = `
                        <div class="privilege-icon">
                            <i class="fas fa-check"></i>
                        </div>
                        <div>
                            <div class="fw-bold">${this.formatPrivilegeName(privilege)}</div>
                            <small class="text-muted">${this.getPrivilegeDescription(privilege)}</small>
                        </div>
                    `;

                    privilegesList.appendChild(item);
                });
            }

            formatPrivilegeName(privilege) {
                return privilege.split('_').map(word =>
                    word.charAt(0).toUpperCase() + word.slice(1)
                ).join(' ');
            }

            getPrivilegeDescription(privilege) {
                const descriptions = {
                    moderate_comments: "Can moderate and review comments",
                    assign_threads: "Can assign threads to other users",
                    priority_support: "Receives priority customer support",
                    collaboration_access: "Full access to collaboration features"
                };

                return descriptions[privilege] || "Special community privilege";
            }

            renderRecommendations() {
                const recommendationsList = document.getElementById('recommendations-list');
                recommendationsList.innerHTML = '';

                this.recommendations.forEach(rec => {
                    const item = document.createElement('div');
                    item.className = 'recommendation-item';

                    const progressPercent = Math.round(rec.progress * 100);

                    item.innerHTML = `
                        <div class="d-flex align-items-center mb-2">
                            <div class="badge-icon me-3" style="color: ${rec.badge_details.color}">${rec.badge_details.icon}</div>
                            <div>
                                <div class="fw-bold">${rec.badge_details.name}</div>
                                <small class="text-muted">${rec.badge_details.description}</small>
                            </div>
                        </div>
                        <div class="recommendation-progress">
                            <div class="recommendation-progress-bar" style="width: ${progressPercent}%"></div>
                        </div>
                        <small class="text-muted">${progressPercent}% complete</small>
                    `;

                    recommendationsList.appendChild(item);
                });
            }

            showBadgeDetails(badgeId) {
                const badge = this.badges.find(b => b.badge_id === badgeId);
                if (badge) {
                    this.showAchievementPopup(badge);
                }
            }

            showAchievementPopup(badge) {
                const popup = document.getElementById('achievement-popup');
                const overlay = document.getElementById('overlay');

                document.getElementById('popup-badge-icon').textContent = badge.badge_details.icon;
                document.getElementById('popup-badge-name').textContent = badge.badge_details.name;
                document.getElementById('popup-badge-description').textContent = badge.badge_details.description;

                popup.classList.add('show');
                overlay.classList.add('show');
            }

            setupAnimations() {
                // Add level up animation when tier changes
                const tierElement = document.getElementById('user-tier');
                tierElement.addEventListener('animationend', () => {
                    tierElement.classList.remove('level-up-animation');
                });

                // Add badge unlock animation
                document.addEventListener('badgeUnlocked', (e) => {
                    const badgeCard = document.querySelector(`[data-badge-id="${e.detail.badgeId}"]`);
                    if (badgeCard) {
                        badgeCard.classList.add('badge-unlock-animation');
                        setTimeout(() => {
                            badgeCard.classList.remove('badge-unlock-animation');
                        }, 800);
                    }
                });
            }

            simulateLevelUp() {
                const tierElement = document.getElementById('user-tier');
                tierElement.classList.add('level-up-animation');

                // Update tier text
                setTimeout(() => {
                    tierElement.textContent = 'Master';
                    tierElement.className = 'reputation-tier tier-master';
                }, 500);
            }

            simulateBadgeUnlock(badgeId) {
                const event = new CustomEvent('badgeUnlocked', {
                    detail: { badgeId: badgeId }
                });
                document.dispatchEvent(event);

                // Show achievement popup
                const badge = this.badges.find(b => b.badge_id === badgeId);
                if (badge) {
                    setTimeout(() => {
                        this.showAchievementPopup(badge);
                    }, 1000);
                }
            }
        }

        function closeAchievementPopup() {
            document.getElementById('achievement-popup').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Initialize the profile
        const userProfile = new UserProfile();

        // Demo functions for testing
        window.simulateLevelUp = () => userProfile.simulateLevelUp();
        window.simulateBadgeUnlock = (badgeId) => userProfile.simulateBadgeUnlock(badgeId);
    </script>
</body>
</html>
