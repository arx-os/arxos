openapi: 3.0.3
info:
  title: ArxOS API
  description: |
    ArxOS - The Git of Buildings

    Complete building management platform with authentication, hierarchical structure,
    and spatial features. Manage buildings, floors, rooms, equipment, and users through
    a comprehensive REST API.

    ## Authentication
    All protected endpoints require JWT authentication via Bearer token in the Authorization header.

    ## Features
    - Building hierarchy management (Building → Floor → Room → Equipment)
    - User authentication and authorization (JWT + bcrypt)
    - Role-based access control (admin, user, viewer)
    - Spatial queries (PostGIS-powered)
    - 3D equipment location tracking
    - Mobile API support

  version: 0.4.0
  contact:
    name: ArxOS API Support
    email: api@arxos.io
  license:
    name: Proprietary

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://api.arxos.io/v1
    description: Production server

tags:
  - name: buildings
    description: Building management operations
  - name: equipment
    description: Equipment tracking and management
  - name: auth
    description: Authentication and authorization
  - name: users
    description: User management
  - name: spatial
    description: Spatial queries and operations

paths:
  # Building Endpoints
  /buildings:
    get:
      tags: [buildings]
      summary: List buildings
      description: Retrieve a list of buildings with optional filtering and pagination
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
          description: Maximum number of results
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
          description: Offset for pagination
        - name: name
          in: query
          schema:
            type: string
          description: Filter by building name (case-insensitive)
      responses:
        '200':
          description: List of buildings
          content:
            application/json:
              schema:
                type: object
                properties:
                  buildings:
                    type: array
                    items:
                      $ref: '#/components/schemas/Building'
                  limit:
                    type: integer
                  offset:
                    type: integer

    post:
      tags: [buildings]
      summary: Create building
      description: Create a new building with optional GPS coordinates
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBuildingRequest'
      responses:
        '201':
          description: Building created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Building'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /buildings/{id}:
    get:
      tags: [buildings]
      summary: Get building
      description: Retrieve a specific building by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Building details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Building'
        '404':
          description: Building not found

    put:
      tags: [buildings]
      summary: Update building
      description: Update building information
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBuildingRequest'
      responses:
        '200':
          description: Building updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Building'

    delete:
      tags: [buildings]
      summary: Delete building
      description: Delete a building (requires no equipment attached)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Building deleted
        '400':
          description: Cannot delete building with equipment

  # Equipment Endpoints
  /equipment:
    get:
      tags: [equipment]
      summary: List equipment
      description: Retrieve equipment with advanced filtering
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: building_id
          in: query
          schema:
            type: string
        - name: floor_id
          in: query
          schema:
            type: string
        - name: room_id
          in: query
          schema:
            type: string
        - name: type
          in: query
          schema:
            type: string
            enum: [hvac, electrical, plumbing, security, fire_safety, elevator, lighting]
        - name: status
          in: query
          schema:
            type: string
            enum: [operational, maintenance, failed, inactive]
      responses:
        '200':
          description: List of equipment
          content:
            application/json:
              schema:
                type: object
                properties:
                  equipment:
                    type: array
                    items:
                      $ref: '#/components/schemas/Equipment'
                  limit:
                    type: integer
                  offset:
                    type: integer

    post:
      tags: [equipment]
      summary: Create equipment
      description: Create new equipment with optional 3D location
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateEquipmentRequest'
      responses:
        '201':
          description: Equipment created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Equipment'

  /equipment/{id}:
    get:
      tags: [equipment]
      summary: Get equipment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Equipment details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Equipment'

    put:
      tags: [equipment]
      summary: Update equipment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEquipmentRequest'
      responses:
        '200':
          description: Equipment updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Equipment'

    delete:
      tags: [equipment]
      summary: Delete equipment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Equipment deleted

  # Authentication Endpoints
  /mobile/auth/register:
    post:
      tags: [auth]
      summary: Register mobile user
      description: Register a new mobile user with email and password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: User registered and logged in
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /mobile/auth/login:
    post:
      tags: [auth]
      summary: Mobile login
      description: Authenticate user and receive JWT tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials

  /mobile/auth/refresh:
    post:
      tags: [auth]
      summary: Refresh token
      description: Get new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
              required: [refresh_token]
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

components:
  schemas:
    Building:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        address:
          type: string
        coordinates:
          $ref: '#/components/schemas/Location'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateBuildingRequest:
      type: object
      required: [name, address]
      properties:
        name:
          type: string
          minLength: 1
        address:
          type: string
          minLength: 1
        coordinates:
          $ref: '#/components/schemas/Location'

    UpdateBuildingRequest:
      type: object
      properties:
        name:
          type: string
        address:
          type: string
        coordinates:
          $ref: '#/components/schemas/Location'

    Equipment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        building_id:
          type: string
          format: uuid
        floor_id:
          type: string
          format: uuid
        room_id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [hvac, electrical, plumbing, security, fire_safety, elevator, lighting]
        model:
          type: string
        location:
          $ref: '#/components/schemas/Location'
        status:
          type: string
          enum: [operational, maintenance, failed, inactive]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreateEquipmentRequest:
      type: object
      required: [building_id, name, type]
      properties:
        building_id:
          type: string
          format: uuid
        floor_id:
          type: string
          format: uuid
        room_id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [hvac, electrical, plumbing, security, fire_safety, elevator, lighting]
        model:
          type: string
        location:
          $ref: '#/components/schemas/Location'

    UpdateEquipmentRequest:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
        model:
          type: string
        location:
          $ref: '#/components/schemas/Location'
        status:
          type: string
          enum: [operational, maintenance, failed, inactive]

    Location:
      type: object
      properties:
        x:
          type: number
          format: double
          description: Longitude or X coordinate
        y:
          type: number
          format: double
          description: Latitude or Y coordinate
        z:
          type: number
          format: double
          description: Altitude or Z coordinate

    RegisterRequest:
      type: object
      required: [username, email, password]
      properties:
        username:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        full_name:
          type: string

    LoginRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
        password:
          type: string
          format: password

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        tokens:
          type: object
          properties:
            access_token:
              type: string
            refresh_token:
              type: string
            expires_in:
              type: integer
            token_type:
              type: string

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        name:
          type: string
        role:
          type: string
          enum: [admin, user, viewer]
        active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        details:
          type: object

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - bearerAuth: []

