# Gateway Configuration
server:
  port: 8080
  host: "0.0.0.0"
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 60s

# Authentication Configuration
auth:
  enabled: true
  jwt_secret: "your-jwt-secret-key"
  jwt_expiry: 24h
  refresh_token_expiry: 168h
  api_key_header: "X-API-Key"
  oauth2:
    enabled: false
    provider_url: ""
    client_id: ""
    client_secret: ""

# Rate Limiting Configuration
rate_limit:
  enabled: true
  requests_per_minute: 100
  burst_size: 20
  storage: "memory"  # memory, redis
  redis:
    host: "localhost"
    port: 6379
    password: ""
    db: 0

# Security Configuration
security:
  cors:
    enabled: true
    allowed_origins: ["*"]
    allowed_methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
    allowed_headers: ["*"]
    allow_credentials: true
    max_age: 86400
  headers:
    enabled: true
    content_security_policy: "default-src 'self'"
    x_frame_options: "DENY"
    x_content_type_options: "nosniff"
    x_xss_protection: "1; mode=block"
    referrer_policy: "strict-origin-when-cross-origin"
  ddos_protection:
    enabled: true
    max_requests_per_second: 10
    block_duration: 300s

# Monitoring Configuration
monitoring:
  enabled: true
  prometheus:
    enabled: true
    path: "/metrics"
  tracing:
    enabled: true
    jaeger_endpoint: "http://localhost:14268/api/traces"
  logging:
    level: "info"
    format: "json"
    output: "stdout"

# Circuit Breaker Configuration
circuit_breaker:
  enabled: true
  failure_threshold: 5
  timeout: 30s
  max_concurrent_requests: 100
  services:
    "arx-svg-parser":
      failure_threshold: 3
      timeout: 10s
    "arx-cmms":
      failure_threshold: 5
      timeout: 15s

# Health Check Configuration
health:
  enabled: true
  interval: 30s
  timeout: 5s
  services:
    - name: "arx-svg-parser"
      url: "http://localhost:8000/health"
      timeout: 5s
    - name: "arx-cmms"
      url: "http://localhost:8001/health"
      timeout: 5s

# Load Balancing Configuration (Phase 4)
load_balancer:
  enabled: true
  default_strategy: "round_robin"
  strategies:
    round_robin:
      type: "round_robin"
    weighted:
      type: "weighted"
    health_based:
      type: "health_based"
    sticky_session:
      type: "sticky_session"
  health_check:
    enabled: true
    interval: 30s
    timeout: 5s
    failure_threshold: 3
    success_threshold: 2
    path: "/health"
  sticky_sessions:
    enabled: true
    duration: 30m
    cookie_name: "session-id"
    header_name: "X-Session-ID"
    max_sessions: 10000
  connection_pool:
    enabled: true
    max_connections: 100
    max_idle_connections: 10
    idle_timeout: 90s
    max_lifetime: 1h
    keep_alive: 30s
    disable_compression: false
    transport_config:
      dial_timeout: 30s
      response_header_timeout: 30s
      expect_continue_timeout: 1s
      idle_conn_timeout: 90s
      tls_handshake_timeout: 10s
      max_idle_conns_per_host: 10
      max_conns_per_host: 100

# Caching Configuration (Phase 4)
cache:
  enabled: true
  default_ttl: 5m
  max_size: 1000
  max_memory: 100MB
  cleanup_interval: 10m
  compression: true
  cache_warming:
    enabled: false
    urls: []
    interval: 1h
    concurrency: 5
  invalidation:
    enabled: true
    patterns: ["/api/*"]
    headers: ["X-Cache-Invalidate"]
    methods: ["POST", "PUT", "DELETE"]
    invalidate_all: false
  content_types:
    - "application/json"
    - "text/html"
    - "text/plain"
    - "application/xml"
  exclude_paths:
    - "/health"
    - "/metrics"
    - "/admin/*"

# Compression Configuration (Phase 4)
compression:
  enabled: true
  min_size: 1024
  compression_level: 6
  supported_encodings:
    - "gzip"
    - "deflate"
  content_types:
    - "application/json"
    - "text/html"
    - "text/plain"
    - "application/xml"
    - "text/css"
    - "application/javascript"
  exclude_paths:
    - "/health"
    - "/metrics"
    - "/admin/*"
  request_compression: true
  response_compression: true

# API Versioning Configuration (Phase 5)
versioning:
  enabled: true
  default_version: "v1"
  version_header: "X-API-Version"
  url_pattern: "/api/v{version}/"
  versions:
    v1:
      version: "v1"
      status: "stable"
      release_date: "2024-01-01T00:00:00Z"
      service: "arx-svg-parser"
      url: "http://localhost:8000"
      documentation: "https://docs.arxos.com/api/v1"
      routes:
        - path: "/api/v1/svg/*"
          methods: ["GET", "POST", "PUT", "DELETE"]
          auth: true
          deprecated: false
        - path: "/api/v1/symbols/*"
          methods: ["GET", "POST"]
          auth: true
          deprecated: false
    v2:
      version: "v2"
      status: "beta"
      release_date: "2024-06-01T00:00:00Z"
      service: "arx-svg-parser-v2"
      url: "http://localhost:8001"
      documentation: "https://docs.arxos.com/api/v2"
      breaking_changes:
        - type: "field_removed"
          description: "Removed 'legacy_field' from response"
          date: "2024-06-01T00:00:00Z"
          migration: "Use 'new_field' instead"
      routes:
        - path: "/api/v2/svg/*"
          methods: ["GET", "POST", "PUT", "DELETE"]
          auth: true
          deprecated: false
        - path: "/api/v2/symbols/*"
          methods: ["GET", "POST", "PUT", "DELETE"]
          auth: true
          deprecated: false
    v3:
      version: "v3"
      status: "deprecated"
      release_date: "2023-01-01T00:00:00Z"
      deprecation_date: "2024-12-31T00:00:00Z"
      service: "arx-svg-parser-v3"
      url: "http://localhost:8002"
      documentation: "https://docs.arxos.com/api/v3"
      routes:
        - path: "/api/v3/svg/*"
          methods: ["GET"]
          auth: true
          deprecated: true
          replacement: "/api/v2/svg/*"
  deprecation_policy:
    enabled: true
    warning_header: "X-API-Deprecation"
    warning_message: "This API version is deprecated"
    grace_period: 30d
    deprecation_header: "Sunset"
    log_deprecation: true
  migration_policy:
    enabled: true
    auto_migration: false
    migration_header: "X-API-Migration"
    migration_message: "Migrate to newer version"
    migration_timeout: 30s
    rollback_enabled: true

# Request/Response Transformation Configuration (Phase 5)
transformation:
  enabled: true
  request_transform: true
  response_transform: true
  max_body_size: 10MB
  compression: true
  rules:
    json_to_xml:
      name: "JSON to XML Transformation"
      enabled: true
      priority: 1
      conditions:
        - type: "header"
          field: "Accept"
          operator: "contains"
          value: "application/xml"
      request_transform:
        headers:
          "Content-Type": "application/xml"
        body:
          type: "json"
          template: "{{.data}}"
      response_transform:
        headers:
          "Content-Type": "application/xml"
        body:
          type: "xml"
          template: "<?xml version=\"1.0\"?><response>{{.data}}</response>"
    version_header_transform:
      name: "Version Header Transformation"
      enabled: true
      priority: 2
      conditions:
        - type: "path"
          field: ""
          operator: "starts_with"
          value: "/api/"
      request_transform:
        headers:
          "X-API-Version": "v2"
          "X-Client-Version": "1.0.0"
    query_param_transform:
      name: "Query Parameter Transformation"
      enabled: true
      priority: 3
      conditions:
        - type: "query"
          field: "format"
          operator: "equals"
          value: "legacy"
      request_transform:
        query_params:
          "legacy": "true"
          "compatibility": "v1"
    error_handling:
      on_error: "skip"
      log_errors: true
      return_error: false
  templates:
    json_response: '{"status": "success", "data": {{.data}}}'
    xml_response: '<?xml version="1.0"?><response><status>success</status><data>{{.data}}</data></response>'
    error_response: '{"error": "{{.message}}", "code": {{.code}}}'

# Advanced Routing Configuration (Phase 5)
advanced_routing:
  enabled: true
  default_service: "arx-svg-parser"
  rules:
    mobile_routing:
      name: "Mobile Device Routing"
      enabled: true
      priority: 1
      type: "header"
      conditions:
        - type: "header"
          field: "User-Agent"
          operator: "contains"
          value: "Mobile"
      actions:
        - type: "proxy"
          service: "arx-svg-parser-mobile"
          url: "http://localhost:8003"
      service: "arx-svg-parser-mobile"
      url: "http://localhost:8003"
    region_routing:
      name: "Regional Routing"
      enabled: true
      priority: 2
      type: "header"
      conditions:
        - type: "header"
          field: "X-Region"
          operator: "equals"
          value: "EU"
      actions:
        - type: "proxy"
          service: "arx-svg-parser-eu"
          url: "http://localhost:8004"
      service: "arx-svg-parser-eu"
      url: "http://localhost:8004"
    api_version_routing:
      name: "API Version Routing"
      enabled: true
      priority: 3
      type: "path"
      conditions:
        - type: "path"
          field: ""
          operator: "starts_with"
          value: "/api/v2/"
      actions:
        - type: "rewrite"
          path: "/api/v2"
        - type: "proxy"
          service: "arx-svg-parser-v2"
      service: "arx-svg-parser-v2"
      url: "http://localhost:8001"
    load_balanced_routing:
      name: "Load Balanced Routing"
      enabled: true
      priority: 4
      type: "weighted"
      conditions:
        - type: "path"
          field: ""
          operator: "starts_with"
          value: "/api/load-balanced/"
      actions:
        - type: "proxy"
          service: "arx-svg-parser-lb"
      service: "arx-svg-parser-lb"
      url: "http://localhost:8005"
      load_balancing:
        strategy: "weighted"
        instances:
          - url: "http://localhost:8006"
            weight: 3
          - url: "http://localhost:8007"
            weight: 2
          - url: "http://localhost:8008"
            weight: 1
    custom_routing:
      name: "Custom Script Routing"
      enabled: true
      priority: 5
      type: "custom"
      conditions:
        - type: "header"
          field: "X-Custom-Routing"
          operator: "exists"
      actions:
        - type: "proxy"
          service: "arx-svg-parser-custom"
      service: "arx-svg-parser-custom"
      url: "http://localhost:8009"
      custom:
        script: "custom_routing.js"
        parameters:
          threshold: "1000"
          factor: "1.5"
  path_rewriting:
    enabled: true
    preserve_query: true
    strip_prefix: false
    add_prefix: ""
    rules:
      legacy_api:
        pattern: "/api/legacy/*"
        replacement: "/api/v1/*"
        regex: false
        conditions:
          - type: "header"
            field: "X-Legacy-Support"
            operator: "equals"
            value: "true"
      version_stripping:
        pattern: "/api/v\\d+/(.*)"
        replacement: "/api/$1"
        regex: true
        conditions:
          - type: "header"
            field: "X-Strip-Version"
            operator: "equals"
            value: "true"
  query_routing:
    enabled: true
    default_service: "arx-svg-parser"
    parameter_mapping:
      format: "response_format"
      version: "api_version"
    rules:
      format_routing:
        parameter: "format"
        values:
          json: "arx-svg-parser"
          xml: "arx-svg-parser-xml"
          csv: "arx-svg-parser-csv"
        default: "arx-svg-parser"
        regex: false
        case_sensitive: false
      version_routing:
        parameter: "version"
        values:
          v1: "arx-svg-parser-v1"
          v2: "arx-svg-parser-v2"
          v3: "arx-svg-parser-v3"
        default: "arx-svg-parser-v2"
        regex: false
        case_sensitive: false
  header_routing:
    enabled: true
    default_service: "arx-svg-parser"
    header_mapping:
      X-API-Version: "api_version"
      X-Client-Type: "client_type"
    rules:
      client_type_routing:
        header: "X-Client-Type"
        values:
          mobile: "arx-svg-parser-mobile"
          web: "arx-svg-parser-web"
          api: "arx-svg-parser-api"
        default: "arx-svg-parser-web"
        regex: false
        case_sensitive: false
      api_version_routing:
        header: "X-API-Version"
        values:
          v1: "arx-svg-parser-v1"
          v2: "arx-svg-parser-v2"
          v3: "arx-svg-parser-v3"
        default: "arx-svg-parser-v2"
        regex: false
        case_sensitive: false
  custom_routing:
    enabled: true
    timeout: 5s
    max_retries: 3
    scripts:
      custom_routing.js:
        language: "javascript"
        script: |
          function route(request) {
            const userAgent = request.headers['User-Agent'] || '';
            const load = parseInt(request.headers['X-Load'] || '0');
            
            if (userAgent.includes('Mobile') && load > 1000) {
              return 'arx-svg-parser-mobile-lite';
            } else if (load > 2000) {
              return 'arx-svg-parser-backup';
            } else {
              return 'arx-svg-parser';
            }
          }
        parameters:
          mobile_threshold: "1000"
          backup_threshold: "2000"
        timeout: 2s
        cache: true
  fallback_policy:
    enabled: true
    service: "arx-svg-parser-fallback"
    status_code: 503
    message: "Service temporarily unavailable"
    log_errors: true

# Services Configuration
services:
  arx-svg-parser:
    name: "SVG Parser Service"
    url: "http://localhost:8000"
    health: "http://localhost:8000/health"
    strategy: "round_robin"
    timeout: 30s
    retries: 3
    routes:
      - path: "/api/svg/*"
        service: "arx-svg-parser"
        methods: ["GET", "POST", "PUT", "DELETE"]
        auth: true
        rate_limit:
          requests_per_minute: 50
          burst_size: 10
        cache:
          enabled: true
          ttl: 10m
        compression:
          enabled: true
          min_size: 512

  arx-cmms:
    name: "CMMS Service"
    url: "http://localhost:8001"
    health: "http://localhost:8001/health"
    strategy: "weighted"
    timeout: 45s
    retries: 2
    routes:
      - path: "/api/cmms/*"
        service: "arx-cmms"
        methods: ["GET", "POST", "PUT", "DELETE"]
        auth: true
        rate_limit:
          requests_per_minute: 30
          burst_size: 5
        cache:
          enabled: true
          ttl: 5m
        compression:
          enabled: true
          min_size: 1024

  arx-backend:
    name: "Arx Backend Service"
    url: "http://localhost:8080"
    health: "http://localhost:8080/health"
    strategy: "health_based"
    timeout: 60s
    retries: 3
    routes:
      - path: "/api/*"
        service: "arx-backend"
        methods: ["GET", "POST", "PUT", "DELETE"]
        auth: true
        rate_limit:
          requests_per_minute: 100
          burst_size: 20
        cache:
          enabled: true
          ttl: 15m
        compression:
          enabled: true
          min_size: 2048

# Metrics Configuration
metrics:
  enabled: true
  namespace: "gateway"
  subsystem: "api"
  labels:
    environment: "development"
    version: "1.0.0"

# Logging Configuration
logging:
  level: "info"
  format: "json"
  output: "stdout"
  fields:
    service: "gateway"
    version: "1.0.0"
    environment: "development"

# Development Configuration
development:
  debug: false
  hot_reload: false
  profiling:
    enabled: false
    port: 6060 