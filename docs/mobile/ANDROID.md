# ArxOS Android Development

Complete guide for building and developing the ArxOS Android app.

---

## Quick Start

### Build on macOS (Terminal)

```bash
cd android

# Set environment variables
export JAVA_HOME=/opt/homebrew/opt/openjdk@17
export ANDROID_HOME=/opt/homebrew/share/android-commandlinetools

# Build APK
./gradlew assembleDebug

# Install on device
adb install app/build/outputs/apk/debug/app-debug.apk
```

### Automated Build Script

```bash
scripts/build-android-mac.sh
```

---

## Environment Setup

### Required Tools (Homebrew)

```bash
# Android tools
brew install android-ndk
brew install android-commandlinetools

# Java & Gradle
brew install openjdk@17
# Gradle comes with Android Command Line Tools

# Set paths
export JAVA_HOME=/opt/homebrew/opt/openjdk@17
export ANDROID_HOME=/opt/homebrew/share/android-commandlinetools
export ANDROID_NDK_HOME=/opt/homebrew/share/android-ndk
```

### SDK Configuration

```bash
# Accept Android licenses
sdkmanager --licenses

# Install required SDK components
sdkmanager "platforms;android-34" "build-tools;34.0.0"
```

**⚠️ Important:** The `android/local.properties` file is automatically generated by Gradle and contains local SDK paths. This file is **gitignored** and should **never** be committed to version control. It's generated per-machine during the build process.

---

## Architecture

### Overview

```
ARScreen (Compose UI)
├── ARViewContainer (AR Integration)
│   ├── GLSurfaceView (Camera Rendering)
│   ├── ARRenderer (OpenGL Pipeline)
│   └── ARCore Session (Plane Detection)
└── Equipment Overlay UI

ARViewModel (State Management)
└── ArxOSCoreService (Business Logic)
    └── ArxOSCoreJNI (Rust FFI)
```

### Key Components

**ARViewContainer.kt**
- Real-time AR camera rendering
- Plane detection and visualization
- Equipment detection callbacks
- 60 FPS OpenGL rendering

**ArxOSCoreService.kt**
- Singleton factory pattern
- Session lifecycle management
- AR scan processing
- Rust backend integration

**ViewModels**
- AndroidViewModel with Application context
- Reactive state management
- Coroutine-based async operations

---

## AR Integration

### Architecture Comparison

| Component | iOS | Android | Status |
|-----------|-----|---------|--------|
| Framework | ARKit | ARCore | ✅ |
| View | ARView | GLSurfaceView | ✅ |
| Rendering | Metal | OpenGL ES 2.0 | ✅ |
| Session | ARSession | Session | ✅ |
| Planes | ARPlaneAnchor | Plane | ✅ |

### Features

✅ Real-time AR camera feed  
✅ Plane detection (horizontal & vertical)  
✅ Equipment detection callbacks  
✅ Session lifecycle management  
✅ Thread-safe rendering  
⚠️ Equipment 3D markers (Phase 4)  
⚠️ Rust CV integration (Phase 5)  

---

## Build System

### Gradle Configuration

```gradle
// Dependencies
implementation 'com.google.ar:core:1.42.0'
implementation 'androidx.compose.material:material-icons-extended'

// ARCore requires
minSdk 24 (Android 7.0+)
```

### Build Output

- **APK:** `app/build/outputs/apk/debug/app-debug.apk`
- **Size:** 18MB (with ARCore)
- **Target:** ARM64, ARMv7

---

## Development Workflow

### Terminal-Only Build

No Android Studio required - complete terminal workflow:

1. **Edit code** in your editor
2. **Build:** `./gradlew assembleDebug`
3. **Test:** `adb install` on device
4. **Debug:** `adb logcat`

### Key Commands

```bash
# Clean build
./gradlew clean assembleDebug

# Check dependencies
./gradlew dependencies

# Run tests
./gradlew test

# Lint check
./gradlew lint
```

---

## Rust Integration

### FFI Bindings

ARXOS uses JNI for Rust ↔ Kotlin communication:

```kotlin
// Native methods
external fun nativeParseARScan(jsonData: String): String
external fun nativeListRooms(buildingName: String): String
```

### Building Rust Libraries

```bash
# Build for Android
cargo ndk -t arm64-v8a -t armeabi-v7a -o android/app/src/main/jniLibs build --release --lib

# Or use script
scripts/build-android-mac.sh
```

---

## Testing

### Device Requirements

- Android 7.0+ (API 24+)
- ARCore-compatible device
- Requires physical device (no emulator)

### Installation

```bash
# Connect device
adb devices

# Install APK
adb install app/build/outputs/apk/debug/app-debug.apk

# View logs
adb logcat | grep ArxOS
```

---

## Troubleshooting

### Common Issues

**ARCore not available**
- Check device compatibility
- Ensure Google Play Services installed
- Verify camera permissions

**Build errors**
- Check Java 17 installed
- Verify Gradle 8.5 wrapper
- Clean build: `./gradlew clean`

**Native library loading**
- Verify `.so` files in `jniLibs/`
- Check Rust build succeeded
- ARM64 library required

**local.properties issues**
- File is auto-generated by Gradle
- Contains only local SDK paths (no secrets)
- Should never be committed to git
- Regenerate with: `./gradlew tasks`

---

## Project Structure

```
android/
├── app/
│   ├── build.gradle          # App dependencies
│   ├── src/main/
│   │   ├── java/.../         # Kotlin source
│   │   │   ├── ui/           # Jetpack Compose UI
│   │   │   ├── service/      # Business logic
│   │   │   ├── data/         # Data models
│   │   │   └── viewmodel/    # State management
│   │   └── jniLibs/          # Rust libraries
│   └── AndroidManifest.xml   # Permissions & config
├── build.gradle               # Root config
└── settings.gradle            # Project structure
```

---

## Next Steps

- ✅ Terminal builds working
- ✅ ARCore integrated
- ✅ iOS parity achieved
- ⏳ Device testing
- ⏳ Equipment visualization
- ⏳ Rust CV integration

---

## Resources

- [ARCore Developer Guide](https://developers.google.com/ar/develop/android/quickstart)
- [Jetpack Compose](https://developer.android.com/jetpack/compose)
- [Gradle Build Tool](https://gradle.org/)
- [Android NDK](https://developer.android.com/ndk)

---

**Status:** Production Ready ✅  
**Last Updated:** January 2025

