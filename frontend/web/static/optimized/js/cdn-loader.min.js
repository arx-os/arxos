class CDNLoader{constructor(){this.loadedAssets=new Set();this.loadingAssets=new Map();this.failedAssets=new Set();}
async loadCSS(path,fallbackPath=null){const assetId=`css:${path}`;if(this.loadedAssets.has(assetId)){return Promise.resolve();}
if(this.loadingAssets.has(assetId)){return this.loadingAssets.get(assetId);}
if(this.failedAssets.has(assetId)){return Promise.reject(new Error(`Asset previously failed to load: ${path}`));}
const cdnUrl=window.CDNUtils.getAssetUrl(path,'css');const fallbackUrl=fallbackPath?window.CDNUtils.getAssetUrl(fallbackPath,'css'):null;const loadPromise=window.CDNUtils.loadCSS(cdnUrl,fallbackUrl).then(()=>{this.loadedAssets.add(assetId);this.loadingAssets.delete(assetId);console.log(`✅ CSS loaded: ${path}`);}).catch(error=>{this.failedAssets.add(assetId);this.loadingAssets.delete(assetId);console.error(`❌ Failed to load CSS: ${path}`,error);throw error;});this.loadingAssets.set(assetId,loadPromise);return loadPromise;}
async loadJS(path,fallbackPath=null){const assetId=`js:${path}`;if(this.loadedAssets.has(assetId)){return Promise.resolve();}
if(this.loadingAssets.has(assetId)){return this.loadingAssets.get(assetId);}
if(this.failedAssets.has(assetId)){return Promise.reject(new Error(`Asset previously failed to load: ${path}`));}
const cdnUrl=window.CDNUtils.getAssetUrl(path,'js');const fallbackUrl=fallbackPath?window.CDNUtils.getAssetUrl(fallbackPath,'js'):null;const loadPromise=window.CDNUtils.loadJS(cdnUrl,fallbackUrl).then(()=>{this.loadedAssets.add(assetId);this.loadingAssets.delete(assetId);console.log(`✅ JavaScript loaded: ${path}`);}).catch(error=>{this.failedAssets.add(assetId);this.loadingAssets.delete(assetId);console.error(`❌ Failed to load JavaScript: ${path}`,error);throw error;});this.loadingAssets.set(assetId,loadPromise);return loadPromise;}
async loadMultipleCSS(paths){const promises=paths.map(path=>this.loadCSS(path));return Promise.all(promises);}
async loadMultipleJS(paths){const promises=paths.map(path=>this.loadJS(path));return Promise.all(promises);}
async loadCriticalAssets(assets={}){const promises=[];if(assets.css){const cssPaths=Array.isArray(assets.css)?assets.css:[assets.css];promises.push(this.loadMultipleCSS(cssPaths));}
if(assets.js){const jsPaths=Array.isArray(assets.js)?assets.js:[assets.js];promises.push(this.loadMultipleJS(jsPaths));}
return Promise.all(promises);}
preloadNonCriticalAssets(assets={}){const preloadAssets=[];if(assets.css){const cssPaths=Array.isArray(assets.css)?assets.css:[assets.css];cssPaths.forEach(path=>{preloadAssets.push({url:window.CDNUtils.getAssetUrl(path,'css'),type:'style'});});}
if(assets.js){const jsPaths=Array.isArray(assets.js)?assets.js:[assets.js];jsPaths.forEach(path=>{preloadAssets.push({url:window.CDNUtils.getAssetUrl(path,'js'),type:'script'});});}
if(assets.images){const imagePaths=Array.isArray(assets.images)?assets.images:[assets.images];imagePaths.forEach(path=>{preloadAssets.push({url:window.CDNUtils.getAssetUrl(path,'images'),type:'image'});});}
if(assets.fonts){const fontPaths=Array.isArray(assets.fonts)?assets.fonts:[assets.fonts];fontPaths.forEach(path=>{preloadAssets.push({url:window.CDNUtils.getAssetUrl(path,'fonts'),type:'font',crossorigin:true});});}
window.CDNUtils.preloadAssets(preloadAssets);}
getAssetURL(path,type='images'){return window.CDNUtils.getAssetUrl(path,type);}
isAssetLoaded(path,type='js'){const assetId=`${type}:${path}`;return this.loadedAssets.has(assetId);}
getStats(){return{loaded:this.loadedAssets.size,loading:this.loadingAssets.size,failed:this.failedAssets.size,loadedAssets:Array.from(this.loadedAssets),failedAssets:Array.from(this.failedAssets)};}
clearFailedAssets(){this.failedAssets.clear();}
reset(){this.loadedAssets.clear();this.loadingAssets.clear();this.failedAssets.clear();}}
window.CDNLoader=new CDNLoader();if(typeof module!=='undefined'&&module.exports){module.exports=CDNLoader;}