{
  "$schema": "https://arxos.dev/specs/arxlink.schema.json",
  "protocol_name": "ArxLink",
  "version": "1.0.0",
  "description": "Lightweight protocol for syncing object states, behaviors, and telemetry",

  "transport_layers": ["MQTT", "TCP", "Serial", "LoRa", "BLE"],
  "data_formats": ["JSON", "MessagePack"],

  "packet_types": {
    "object_update": {
      "description": "Object state update from device to Arxos",
      "direction": "device_to_arxos",
      "fields": {
        "type": {
          "type": "string",
          "required": true,
          "value": "object_update"
        },
        "timestamp": {
          "type": "integer",
          "required": true,
          "description": "Unix timestamp in seconds"
        },
        "object_id": {
          "type": "string",
          "required": true,
          "description": "Unique device identifier"
        },
        "values": {
          "type": "object",
          "required": true,
          "description": "Key-value pairs of sensor readings and states"
        },
        "sequence": {
          "type": "integer",
          "required": false,
          "description": "Packet sequence number for ordering"
        },
        "checksum": {
          "type": "string",
          "required": true,
          "description": "SHA256 checksum of packet data"
        }
      }
    },

    "command_request": {
      "description": "Command from Arxos to device",
      "direction": "arxos_to_device",
      "fields": {
        "type": {
          "type": "string",
          "required": true,
          "value": "command_request"
        },
        "timestamp": {
          "type": "integer",
          "required": true,
          "description": "Unix timestamp in seconds"
        },
        "object_id": {
          "type": "string",
          "required": true,
          "description": "Target device identifier"
        },
        "command": {
          "type": "string",
          "required": true,
          "description": "Command name (e.g., 'set_damper_position')"
        },
        "parameters": {
          "type": "object",
          "required": false,
          "description": "Command parameters"
        },
        "sequence": {
          "type": "integer",
          "required": false,
          "description": "Packet sequence number for ordering"
        },
        "checksum": {
          "type": "string",
          "required": true,
          "description": "SHA256 checksum of packet data"
        }
      }
    },

    "command_response": {
      "description": "Command response from device to Arxos",
      "direction": "device_to_arxos",
      "fields": {
        "type": {
          "type": "string",
          "required": true,
          "value": "command_response"
        },
        "timestamp": {
          "type": "integer",
          "required": true,
          "description": "Unix timestamp in seconds"
        },
        "object_id": {
          "type": "string",
          "required": true,
          "description": "Device identifier"
        },
        "command": {
          "type": "string",
          "required": true,
          "description": "Original command name"
        },
        "status": {
          "type": "string",
          "required": true,
          "enum": ["success", "error", "timeout"],
          "description": "Command execution status"
        },
        "result": {
          "type": "object",
          "required": false,
          "description": "Command result data"
        },
        "error_message": {
          "type": "string",
          "required": false,
          "description": "Error description if status is error"
        },
        "sequence": {
          "type": "integer",
          "required": false,
          "description": "Packet sequence number for ordering"
        },
        "checksum": {
          "type": "string",
          "required": true,
          "description": "SHA256 checksum of packet data"
        }
      }
    },

    "heartbeat": {
      "description": "Device heartbeat/keepalive",
      "direction": "device_to_arxos",
      "fields": {
        "type": {
          "type": "string",
          "required": true,
          "value": "heartbeat"
        },
        "timestamp": {
          "type": "integer",
          "required": true,
          "description": "Unix timestamp in seconds"
        },
        "object_id": {
          "type": "string",
          "required": true,
          "description": "Device identifier"
        },
        "uptime": {
          "type": "integer",
          "required": false,
          "description": "Device uptime in seconds"
        },
        "memory_usage": {
          "type": "float",
          "required": false,
          "description": "Memory usage percentage"
        },
        "checksum": {
          "type": "string",
          "required": true,
          "description": "SHA256 checksum of packet data"
        }
      }
    },

    "alarm": {
      "description": "Device alarm/alert",
      "direction": "device_to_arxos",
      "fields": {
        "type": {
          "type": "string",
          "required": true,
          "value": "alarm"
        },
        "timestamp": {
          "type": "integer",
          "required": true,
          "description": "Unix timestamp in seconds"
        },
        "object_id": {
          "type": "string",
          "required": true,
          "description": "Device identifier"
        },
        "alarm_id": {
          "type": "string",
          "required": true,
          "description": "Alarm identifier"
        },
        "severity": {
          "type": "string",
          "required": true,
          "enum": ["info", "warning", "error", "critical"],
          "description": "Alarm severity level"
        },
        "message": {
          "type": "string",
          "required": true,
          "description": "Alarm description"
        },
        "data": {
          "type": "object",
          "required": false,
          "description": "Additional alarm data"
        },
        "checksum": {
          "type": "string",
          "required": true,
          "description": "SHA256 checksum of packet data"
        }
      }
    }
  },

  "security": {
    "encryption": "NaCl (libsodium) with Ed25519 keys",
    "authentication": "Device certificates and checksum-based integrity",
    "packet_signing": true,
    "key_exchange": "X25519",
    "signature_algorithm": "Ed25519"
  },

  "transport_config": {
    "mqtt": {
      "qos": 1,
      "retain": false,
      "clean_session": true,
      "keepalive": 60
    },
    "tcp": {
      "port": 1883,
      "timeout": 30,
      "keepalive": true
    },
    "serial": {
      "baud_rate": 115200,
      "data_bits": 8,
      "stop_bits": 1,
      "parity": "none"
    },
    "lora": {
      "frequency": 915000000,
      "bandwidth": 125000,
      "spreading_factor": 7,
      "coding_rate": 5
    },
    "ble": {
      "service_uuid": "12345678-1234-1234-1234-123456789abc",
      "characteristic_uuid": "87654321-4321-4321-4321-cba987654321"
    }
  },

  "examples": {
    "object_update": {
      "type": "object_update",
      "timestamp": 1724382371,
      "object_id": "ahu-001",
      "values": {
        "temp_sensor": 23.5,
        "co2_sensor": 840,
        "fan_relay": true,
        "damper_position": 75.2
      },
      "sequence": 12345,
      "checksum": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
    },

    "command_request": {
      "type": "command_request",
      "timestamp": 1724382372,
      "object_id": "ahu-001",
      "command": "set_damper_position",
      "parameters": {
        "position": 80.0
      },
      "sequence": 12346,
      "checksum": "b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456a1"
    }
  }
}
