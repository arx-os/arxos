name: IFC Import Workflow

on:
  workflow_dispatch:
    inputs:
      ifc_file:
        description: 'Path to IFC file to import'
        required: true
        default: 'test_data/sample_building.ifc'
      output_directory:
        description: 'Output directory for processed data'
        required: false
        default: 'building-data'
      commit_message:
        description: 'Custom commit message'
        required: false
        default: 'Import IFC file: {ifc_file}'
  
  push:
    paths:
      - 'test_data/**/*.ifc'
      - '**/*.ifc'
  
  pull_request:
    paths:
      - 'test_data/**/*.ifc'
      - '**/*.ifc'

jobs:
  import-ifc:
    runs-on: ubuntu-latest
    name: Import IFC File
    
    steps:
      - name: Process IFC file
        uses: ./.github/actions/ifc-processor
        with:
          ifc-file: ${{ github.event.inputs.ifc_file || 'test_data/sample_building.ifc' }}
          output-dir: ${{ github.event.inputs.output_directory || 'building-data' }}
          commit-message: ${{ github.event.inputs.commit_message || 'Import IFC file' }}
          validate-spatial: 'true'
      
      - name: Validate processed data
        uses: ./.github/actions/spatial-validator
        with:
          data-path: ${{ github.event.inputs.output_directory || 'building-data' }}
          tolerance: '0.1'
          check-coordinate-systems: 'true'
          check-universal-paths: 'true'
      
      - name: Generate building report
        uses: ./.github/actions/building-reporter
        with:
          data-path: ${{ github.event.inputs.output_directory || 'building-data' }}
          report-type: 'summary'
          output-format: 'markdown'
          commit-report: 'true'

  notify-on-success:
    runs-on: ubuntu-latest
    needs: import-ifc
    if: success()
    
    steps:
      - name: Notify successful import
        run: |
          echo "âœ… IFC file successfully imported and processed!"
          echo "ðŸ“Š Building data validated and report generated"
          echo "ðŸ”— View the results in the repository"