class LoggingReplacer{constructor(){this.replacements=[{pattern:/console\.log\('([^']+)'\)/g,replacement:(match,message)=>this.determineLogLevel(message,'info')},{pattern:/console\.log\(`([^`]+)`\)/g,replacement:(match,message)=>this.determineLogLevel(message,'info')},{pattern:/console\.log\(([^)]+)\)/g,replacement:(match,expression)=>this.determineLogLevel(expression,'info')},{pattern:/console\.log\(([^)]+(?:,\s*[^)]+)*)\)/g,replacement:(match,args)=>this.determineLogLevel(args,'info')}];this.logLevelPatterns={error:[/error/i,/failed/i,/failure/i,/exception/i,/crash/i,/broken/i,/invalid/i,/missing/i,/not found/i,/unauthorized/i,/forbidden/i,/timeout/i,/connection failed/i,/network error/i],warning:[/warn/i,/warning/i,/deprecated/i,/obsolete/i,/slow/i,/performance/i,/retry/i,/fallback/i,/degraded/i,/partial/i,/incomplete/i],debug:[/debug/i,/test/i,/testing/i,/tester/i,/performance/i,/benchmark/i,/profile/i,/trace/i,/verbose/i,/detailed/i,/step/i,/phase/i],info:[/info/i,/connected/i,/disconnected/i,/initialized/i,/started/i,/completed/i,/finished/i,/loaded/i,/saved/i,/updated/i,/created/i,/deleted/i,/moved/i,/resized/i,/selected/i,/deselected/i]};this.contextPatterns={performance:[/performance/i,/benchmark/i,/timing/i,/duration/i,/ms/i,/milliseconds/i,/fps/i,/frame/i,/render/i,/load time/i,/response time/i],connection:[/connected/i,/disconnected/i,/websocket/i,/socket/i,/reconnect/i,/connection/i,/network/i,/api/i,/request/i,/response/i],user:[/user/i,/click/i,/interaction/i,/action/i,/event/i,/input/i,/form/i,/submit/i,/validation/i,/error/i],system:[/system/i,/service/i,/component/i,/module/i,/initialized/i,/started/i,/stopped/i,/shutdown/i,/restart/i],data:[/data/i,/object/i,/array/i,/property/i,/value/i,/state/i,/cache/i,/storage/i,/database/i,/query/i]};this.isInitialized=false;this.processedFiles=new Set();}
initialize(){if(this.isInitialized){console.warn('LoggingReplacer already initialized');return;}
if(typeof window.arxLogger==='undefined'){console.warn('ArxLogger not found. Creating default instance...');window.arxLogger=new ArxLogger({service:'arx-web-frontend',environment:window.location.hostname==='localhost'?'development':'production',enableRemoteLogging:true,remoteEndpoint:'/api/logs/aggregate'});}
this.overrideConsoleLog();this.replaceAll();this.setupMutationObserver();this.isInitialized=true;console.log('LoggingReplacer initialized successfully');}
overrideConsoleLog(){const originalConsoleLog=console.log;const self=this;console.log=function(...args){const message=args.map(arg=>typeof arg==='string'?arg:JSON.stringify(arg)).join(' ');const logLevel=self.determineLogLevel(message,'info');const context=self.determineContext(message);if(window.arxLogger){const metadata={context,originalArgs:args};window.arxLogger[logLevel](message,metadata);}else{originalConsoleLog.apply(console,args);}};}
determineLogLevel(message,defaultLevel='info'){const lowerMessage=message.toLowerCase();for(const pattern of this.logLevelPatterns.error){if(pattern.test(lowerMessage)){return'error';}}
for(const pattern of this.logLevelPatterns.warning){if(pattern.test(lowerMessage)){return'warning';}}
for(const pattern of this.logLevelPatterns.debug){if(pattern.test(lowerMessage)){return'debug';}}
for(const pattern of this.logLevelPatterns.info){if(pattern.test(lowerMessage)){return'info';}}
return defaultLevel;}
determineContext(message){const lowerMessage=message.toLowerCase();const contexts=[];for(const[context,patterns]of Object.entries(this.contextPatterns)){for(const pattern of patterns){if(pattern.test(lowerMessage)){contexts.push(context);break;}}}
return contexts.length>0?contexts:['general'];}
replaceInFile(fileContent,fileName='unknown'){if(this.processedFiles.has(fileName)){return fileContent;}
let modifiedContent=fileContent;let replacements=0;for(const replacement of this.replacements){const matches=fileContent.match(replacement.pattern);if(matches){replacements+=matches.length;modifiedContent=modifiedContent.replace(replacement.pattern,(match,...args)=>{const message=args[0];const logLevel=this.determineLogLevel(message,'info');const context=this.determineContext(message);if(match.includes('`')){return`window.arxLogger.${logLevel}(\`${message}\`, { context: '${context.join(',')}', file: '${fileName}' })`;}else if(match.includes("'")){return`window.arxLogger.${logLevel}('${message}', { context: '${context.join(',')}', file: '${fileName}' })`;}else{return`window.arxLogger.${logLevel}(${message}, { context: '${context.join(',')}', file: '${fileName}' })`;}});}}
if(replacements>0){console.log(`LoggingReplacer: Replaced ${replacements} console.log calls in ${fileName}`);}
this.processedFiles.add(fileName);return modifiedContent;}
replaceAll(){const scripts=document.querySelectorAll('script[src*=".js"]');scripts.forEach(script=>{const src=script.getAttribute('src');if(src&&!this.processedFiles.has(src)){console.log(`LoggingReplacer: Found script ${src}`);}});}
setupMutationObserver(){const observer=new MutationObserver((mutations)=>{mutations.forEach((mutation)=>{mutation.addedNodes.forEach((node)=>{if(node.nodeType===Node.ELEMENT_NODE){if(node.tagName==='SCRIPT'){if(node.src){console.log(`LoggingReplacer: New script detected: ${node.src}`);}else if(node.textContent){const processedContent=this.replaceInFile(node.textContent,'inline');if(processedContent!==node.textContent){node.textContent=processedContent;}}}}});});});observer.observe(document.head,{childList:true,subtree:true});observer.observe(document.body,{childList:true,subtree:true});}
async processFile(filePath){try{const response=await fetch(filePath);const content=await response.text();const processedContent=this.replaceInFile(content,filePath);const script=document.createElement('script');script.textContent=processedContent;script.setAttribute('data-processed','true');const originalScript=document.querySelector(`script[src="${filePath}"]`);if(originalScript){originalScript.parentNode.replaceChild(script,originalScript);}else{document.head.appendChild(script);}
return processedContent;}catch(error){console.error(`LoggingReplacer: Error processing file ${filePath}:`,error);return null;}}
getStats(){return{processedFiles:Array.from(this.processedFiles),totalFiles:this.processedFiles.size,isInitialized:this.isInitialized};}
reset(){this.processedFiles.clear();this.isInitialized=false;console.log('LoggingReplacer reset');}}
window.LoggingReplacer=new LoggingReplacer();if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{window.LoggingReplacer.initialize();});}else{window.LoggingReplacer.initialize();}
if(typeof module!=='undefined'&&module.exports){module.exports=LoggingReplacer;}
