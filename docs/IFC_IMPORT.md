# IFC Import Support

ArxOS now supports importing IFC (Industry Foundation Classes) files directly from professional BIM software like Revit, AutoCAD, ArchiCAD, and other building design tools.

## What is IFC?

IFC (Industry Foundation Classes) is the international standard for Building Information Modeling (BIM) data exchange. It's an open format that contains:

- Building geometry and spatial structure
- Equipment and building elements
- Material properties and specifications
- System relationships and connections
- Metadata and project information

## Supported Software

ArxOS can import IFC files generated by:

- **Autodesk Revit** - Architecture, MEP, and structural models
- **AutoCAD Architecture** - Building designs and floor plans
- **ArchiCAD** - Architectural models with MEP elements
- **Bentley MicroStation** - Infrastructure and building models
- **SketchUp Pro** - 3D building models with IFC export
- **FreeCAD** - Open-source CAD with IFC support
- **Blender** - 3D modeling with BlenderBIM addon

## IFC Commands

### Import IFC Files

```bash
# Preview import (default - doesn't save)
arx ifc import building.ifc

# Actually import and save to ArxOS
arx ifc import building.ifc --preview=false

# Verbose import with detailed information
arx ifc import building.ifc --preview=false --verbose-import
```

### Analyze IFC Files

```bash
# Get detailed file information
arx ifc info building.ifc

# Validate file format and structure
arx ifc validate building.ifc

# JSON output for automation
arx --json ifc info building.ifc
```

## Import Process

### 1. IFC Parsing

ArxOS parses the IFC file structure:

- **HEADER section**: File metadata, authoring info, timestamps
- **DATA section**: Building entities, geometry, relationships
- **Entity types**: Spaces, equipment, connections, properties

### 2. Equipment Extraction

The parser identifies and extracts common building equipment:

| IFC Entity Type | ArxOS Equipment Type | Description |
|----------------|---------------------|-------------|
| `IFCELECTRICDISTRIBUTIONBOARD` | `panel` | Electrical panels and distribution boards |
| `IFCOUTLET` | `outlet` | Power outlets and receptacles |
| `IFCSWITCHINGDEVICE` | `switch` | Light switches and controls |
| `IFCLIGHTFIXTURE` | `light_fixture` | Lighting fixtures and luminaires |
| `IFCJUNCTIONBOX` | `junction_box` | Electrical junction boxes |
| `IFCALARM` | `alarm` | Fire alarms, smoke detectors |
| `IFCELECTRICAPPLIANCEUNIT` | `appliance` | Electrical appliances |
| `IFCUNITARYEQUIPMENT` | `unitary_equipment` | HVAC and mechanical units |
| `IFCCOMMUNICATIONSAPPLIANCE` | `communications` | Network and telecom equipment |

### 3. Spatial Structure

The parser converts IFC spatial elements:

- **IFCSPACE** → ArxOS Rooms
- **IFCBUILDINGSTOREY** → Floor level information
- **IFCBUILDING** → Building metadata
- **IFCSITE** → Site context

### 4. ArxOS Integration

Imported data integrates with all ArxOS features:

- **ASCII Maps**: Visual floor plan representation
- **Equipment Tracking**: Status monitoring and markup
- **Connection Analysis**: System relationship mapping
- **Monitoring**: Real-time system health tracking
- **JSON Export**: Structured data for automation

## Example Workflow

### 1. Import from Revit

```bash
# Export IFC from Revit MEP model
# File → Export → IFC → Save as "office_building_mep.ifc"

# Import to ArxOS
arx ifc import office_building_mep.ifc --preview=false --verbose-import

# View the imported floor plan
arx map office_building_mep

# Check equipment status
arx status office_building_mep
```

### 2. Analysis and Monitoring

```bash
# List all equipment from IFC
arx query "SELECT name, type, status FROM equipment WHERE notes LIKE '%IFC%'"

# Create connections between equipment
arx connect outlet_1 panel_main --type power
arx connect light_switch_1 light_fixture_1 --type control

# Monitor system health
arx monitor --snapshot
```

### 3. Integration with BIM Workflow

```bash
# Get equipment data for external systems
arx --json status | jq '.data.equipment_summary'

# Export failure analysis back to CSV for BIM software
arx --json query "SELECT * FROM equipment WHERE status = 'failed'" | \
  jq -r '.data.rows[] | @csv' > failed_equipment.csv
```

## Advanced Features

### JSON Integration

All IFC commands support JSON output for automation:

```bash
# Get IFC metadata
arx --json ifc info building.ifc | jq '.data.header_info'

# Import with structured results
arx --json ifc import building.ifc --preview=false | jq '.data.ifc_metadata'

# Validate multiple files
for file in *.ifc; do
  arx --json ifc validate "$file" | jq -r "select(.data.is_valid == false) | .data.file_path"
done
```

### Automation Scripts

```bash
#!/bin/bash
# Process all IFC files in a directory
for ifc_file in /path/to/bim/exports/*.ifc; do
  echo "Processing $ifc_file..."
  
  # Validate first
  if arx --json ifc validate "$ifc_file" | jq -r '.data.is_valid' | grep -q true; then
    # Import if valid
    arx ifc import "$ifc_file" --preview=false
    echo "✅ Imported $(basename "$ifc_file")"
  else
    echo "❌ Invalid IFC file: $(basename "$ifc_file")"
  fi
done
```

## IFC File Structure Support

### Supported IFC Versions

- **IFC4** (recommended) - Latest standard with enhanced MEP support
- **IFC2x3** - Widely supported legacy version
- **IFC4.1/4.2/4.3** - Latest versions with infrastructure support

### Supported Model View Definitions (MVD)

- **Coordination View** - Basic geometry and spatial structure
- **Reference View** - Simplified geometry for reference
- **Design Transfer View** - Detailed design information
- **Quantity Take-off View** - Material and quantity data

### Common IFC Export Settings

When exporting from BIM software to ensure best compatibility:

#### Revit Export Settings
- **Model View Definition**: Coordination View 2.0
- **Space boundaries**: Include for room detection  
- **Split walls and columns by level**: Yes
- **Export schedules as property sets**: Yes
- **Include steel elements**: If applicable

#### AutoCAD Architecture Settings
- **Version**: IFC4 or IFC2x3
- **Coordinate system**: Project base point
- **Include room/space objects**: Yes
- **Export object properties**: Yes

## Limitations and Notes

### Current Limitations

1. **Geometry Simplification**: Complex 3D geometry is simplified to 2D bounds
2. **Material Properties**: Materials are not currently imported (planned for future)
3. **Parametric Relationships**: Parameter relationships are not preserved
4. **Annotations**: Text annotations and dimensions are not imported
5. **Layers/Categories**: Layer information is simplified to equipment types

### Performance Considerations

- Large IFC files (>100MB) may take longer to process
- Complex geometry with many curves/surfaces is simplified
- Memory usage scales with entity count (typical: 1MB RAM per 1000 entities)

### Best Practices

1. **Use MVD Coordination View** for best compatibility
2. **Include spaces/rooms** in IFC export for proper room detection
3. **Export MEP elements** separately if possible for cleaner results
4. **Use consistent naming** conventions in source BIM software
5. **Test with preview mode** before full import

## Troubleshooting

### Common Issues

**"No equipment found"**
- Ensure MEP elements are included in IFC export
- Check that equipment has proper IFC classifications
- Try different Model View Definition in export

**"Invalid IFC format"**
- Validate source file with `arx ifc validate`
- Check file encoding (should be UTF-8)
- Re-export from source software with default settings

**"Processing very slow"**
- Large files may need time - check with `arx ifc info` first
- Consider splitting large models by discipline
- Use preview mode to estimate processing time

### Getting Help

```bash
# Check IFC file details
arx ifc info problem_file.ifc

# Validate file structure
arx ifc validate problem_file.ifc

# Preview import to see what would be extracted
arx ifc import problem_file.ifc --preview --verbose-import
```

## Future Enhancements

Planned improvements for IFC support:

- **Geometric Processing**: Better 3D to 2D conversion
- **Material Import**: Physical properties and specifications  
- **Relationship Preservation**: Maintain more BIM relationships
- **Multi-Discipline Support**: Better structural/civil element handling
- **Export to IFC**: Round-trip capability back to BIM software
- **Version Control**: Track changes between IFC versions

This IFC support bridges the gap between professional BIM workflows and ArxOS terminal-native building intelligence, enabling seamless integration with existing design and construction processes.